var requirejs,require,define;!function(global){function isFunction(t){return"[object Function]"===ostring.call(t)}function isArray(t){return"[object Array]"===ostring.call(t)}function each(t,e){if(t){var n;for(n=0;n<t.length&&(!t[n]||!e(t[n],n,t));n+=1);}}function eachReverse(t,e){if(t){var n;for(n=t.length-1;n>-1&&(!t[n]||!e(t[n],n,t));n-=1);}}function hasProp(t,e){return hasOwn.call(t,e)}function getOwn(t,e){return hasProp(t,e)&&t[e]}function eachProp(t,e){var n;for(n in t)if(hasProp(t,n)&&e(t[n],n))break}function mixin(t,e,n,i){return e&&eachProp(e,function(e,o){(n||!hasProp(t,o))&&(i&&"string"!=typeof e?(t[o]||(t[o]={}),mixin(t[o],e,n,i)):t[o]=e)}),t}function bind(t,e){return function(){return e.apply(t,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(t){throw t}function getGlobal(t){if(!t)return t;var e=global;return each(t.split("."),function(t){e=e[t]}),e}function makeError(t,e,n,i){var o=new Error(e+"\nhttp://requirejs.org/docs/errors.html#"+t);return o.requireType=t,o.requireModules=i,n&&(o.originalError=n),o}function newContext(t){function e(t){var e,n;for(e=0;t[e];e+=1)if(n=t[e],"."===n)t.splice(e,1),e-=1;else if(".."===n){if(1===e&&(".."===t[2]||".."===t[0]))break;e>0&&(t.splice(e-1,2),e-=2)}}function n(t,n,i){var o,r,a,s,u,c,h,d,l,f,p,g=n&&n.split("/"),m=g,v=S.map,y=v&&v["*"];if(t&&"."===t.charAt(0)&&(n?(m=getOwn(S.pkgs,n)?g=[n]:g.slice(0,g.length-1),t=m.concat(t.split("/")),e(t),r=getOwn(S.pkgs,o=t[0]),t=t.join("/"),r&&t===o+"/"+r.main&&(t=o)):0===t.indexOf("./")&&(t=t.substring(2))),i&&v&&(g||y)){for(s=t.split("/"),u=s.length;u>0;u-=1){if(h=s.slice(0,u).join("/"),g)for(c=g.length;c>0;c-=1)if(a=getOwn(v,g.slice(0,c).join("/")),a&&(a=getOwn(a,h))){d=a,l=u;break}if(d)break;!f&&y&&getOwn(y,h)&&(f=getOwn(y,h),p=u)}!d&&f&&(d=f,l=p),d&&(s.splice(0,l,d),t=s.join("/"))}return t}function i(t){isBrowser&&each(scripts(),function(e){return e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===b.contextName?(e.parentNode.removeChild(e),!0):void 0})}function o(t){var e=getOwn(S.paths,t);return e&&isArray(e)&&e.length>1?(e.shift(),b.require.undef(t),b.require([t]),!0):void 0}function r(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function a(t,e,i,o){var a,s,u,c,h=null,d=e?e.name:null,l=t,f=!0,p="";return t||(f=!1,t="_@r"+(I+=1)),c=r(t),h=c[0],t=c[1],h&&(h=n(h,d,o),s=getOwn(C,h)),t&&(h?p=s&&s.normalize?s.normalize(t,function(t){return n(t,d,o)}):n(t,d,o):(p=n(t,d,o),c=r(p),h=c[0],p=c[1],i=!0,a=b.nameToUrl(p))),u=!h||s||i?"":"_unnormalized"+(R+=1),{prefix:h,name:p,parentMap:e,unnormalized:!!u,url:a,originalName:l,isDefine:f,id:(h?h+"!"+p:p)+u}}function s(t){var e=t.id,n=getOwn(k,e);return n||(n=k[e]=new b.Module(t)),n}function u(t,e,n){var i=t.id,o=getOwn(k,i);!hasProp(C,i)||o&&!o.defineEmitComplete?(o=s(t),o.error&&"error"===e?n(o.error):o.on(e,n)):"defined"===e&&n(C[i])}function c(t,e){var n=t.requireModules,i=!1;e?e(t):(each(n,function(e){var n=getOwn(k,e);n&&(n.error=t,n.events.error&&(i=!0,n.emit("error",t)))}),i||req.onError(t))}function h(){globalDefQueue.length&&(apsp.apply(A,[A.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function d(t){delete k[t],delete P[t]}function l(t,e,n){var i=t.map.id;t.error?t.emit("error",t.error):(e[i]=!0,each(t.depMaps,function(i,o){var r=i.id,a=getOwn(k,r);!a||t.depMatched[o]||n[r]||(getOwn(e,r)?(t.defineDep(o,C[r]),t.check()):l(a,e,n))}),n[i]=!0)}function f(){var t,e,n,r,a=1e3*S.waitSeconds,s=a&&b.startTime+a<(new Date).getTime(),u=[],h=[],d=!1,p=!0;if(!y){if(y=!0,eachProp(P,function(n){if(t=n.map,e=t.id,n.enabled&&(t.isDefine||h.push(n),!n.error))if(!n.inited&&s)o(e)?(r=!0,d=!0):(u.push(e),i(e));else if(!n.inited&&n.fetched&&t.isDefine&&(d=!0,!t.prefix))return p=!1}),s&&u.length)return n=makeError("timeout","Load timeout for modules: "+u,null,u),n.contextName=b.contextName,c(n);p&&each(h,function(t){l(t,{},{})}),s&&!r||!d||!isBrowser&&!isWebWorker||E||(E=setTimeout(function(){E=0,f()},50)),y=!1}}function p(t){hasProp(C,t[0])||s(a(t[0],null,!0)).init(t[1],t[2])}function g(t,e,n,i){t.detachEvent&&!isOpera?i&&t.detachEvent(i,e):t.removeEventListener(n,e,!1)}function m(t){var e=t.currentTarget||t.srcElement;return g(e,b.onScriptLoad,"load","onreadystatechange"),g(e,b.onScriptError,"error"),{node:e,id:e&&e.getAttribute("data-requiremodule")}}function v(){var t;for(h();A.length;){if(t=A.shift(),null===t[0])return c(makeError("mismatch","Mismatched anonymous define() module: "+t[t.length-1]));p(t)}}var y,w,b,x,E,S={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},k={},P={},O={},A=[],C={},M={},I=1,R=1;return x={require:function(t){return t.require?t.require:t.require=b.makeRequire(t.map)},exports:function(t){return t.usingExports=!0,t.map.isDefine?t.exports?t.exports:t.exports=C[t.map.id]={}:void 0},module:function(t){return t.module?t.module:t.module={id:t.map.id,uri:t.map.url,config:function(){var e,n=getOwn(S.pkgs,t.map.id);return e=n?getOwn(S.config,t.map.id+"/"+n.main):getOwn(S.config,t.map.id),e||{}},exports:C[t.map.id]}}},w=function(t){this.events=getOwn(O,t.id)||{},this.map=t,this.shim=getOwn(S.shim,t.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},w.prototype={init:function(t,e,n,i){i=i||{},this.inited||(this.factory=e,n?this.on("error",n):this.events.error&&(n=bind(this,function(t){this.emit("error",t)})),this.depMaps=t&&t.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(t,e){this.depMatched[t]||(this.depMatched[t]=!0,this.depCount-=1,this.depExports[t]=e)},fetch:function(){if(!this.fetched){this.fetched=!0,b.startTime=(new Date).getTime();var t=this.map;return this.shim?void b.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return t.prefix?this.callPlugin():this.load()})):t.prefix?this.callPlugin():this.load()}},load:function(){var t=this.map.url;M[t]||(M[t]=!0,b.load(this.map.id,t))},check:function(){if(this.enabled&&!this.enabling){var t,e,n=this.map.id,i=this.depExports,o=this.exports,r=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(r)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{o=b.execCb(n,r,i,o)}catch(a){t=a}else o=b.execCb(n,r,i,o);if(this.map.isDefine&&(e=this.module,e&&void 0!==e.exports&&e.exports!==this.exports?o=e.exports:void 0===o&&this.usingExports&&(o=this.exports)),t)return t.requireMap=this.map,t.requireModules=this.map.isDefine?[this.map.id]:null,t.requireType=this.map.isDefine?"define":"require",c(this.error=t)}else o=r;this.exports=o,this.map.isDefine&&!this.ignore&&(C[n]=o,req.onResourceLoad&&req.onResourceLoad(b,this.map,this.depMaps)),d(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var t=this.map,e=t.id,i=a(t.prefix);this.depMaps.push(i),u(i,"defined",bind(this,function(i){var o,r,h,l=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null,p=b.makeRequire(t.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(i.normalize&&(l=i.normalize(l,function(t){return n(t,f,!0)})||""),r=a(t.prefix+"!"+l,this.map.parentMap),u(r,"defined",bind(this,function(t){this.init([],function(){return t},null,{enabled:!0,ignore:!0})})),h=getOwn(k,r.id),void(h&&(this.depMaps.push(r),this.events.error&&h.on("error",bind(this,function(t){this.emit("error",t)})),h.enable()))):(o=bind(this,function(t){this.init([],function(){return t},null,{enabled:!0})}),o.error=bind(this,function(t){this.inited=!0,this.error=t,t.requireModules=[e],eachProp(k,function(t){0===t.map.id.indexOf(e+"_unnormalized")&&d(t.map.id)}),c(t)}),o.fromText=bind(this,function(n,i){var r=t.name,u=a(r),h=useInteractive;i&&(n=i),h&&(useInteractive=!1),s(u),hasProp(S.config,e)&&(S.config[r]=S.config[e]);try{req.exec(n)}catch(d){return c(makeError("fromtexteval","fromText eval for "+e+" failed: "+d,d,[e]))}h&&(useInteractive=!0),this.depMaps.push(u),b.completeLoad(r),p([r],o)}),void i.load(t.name,p,o,S))})),b.enable(i,this),this.pluginMaps[i.id]=i},enable:function(){P[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(t,e){var n,i,o;if("string"==typeof t){if(t=a(t,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[e]=t,o=getOwn(x,t.id))return void(this.depExports[e]=o(this));this.depCount+=1,u(t,"defined",bind(this,function(t){this.defineDep(e,t),this.check()})),this.errback&&u(t,"error",bind(this,this.errback))}n=t.id,i=k[n],hasProp(x,n)||!i||i.enabled||b.enable(t,this)})),eachProp(this.pluginMaps,bind(this,function(t){var e=getOwn(k,t.id);e&&!e.enabled&&b.enable(t,this)})),this.enabling=!1,this.check()},on:function(t,e){var n=this.events[t];n||(n=this.events[t]=[]),n.push(e)},emit:function(t,e){each(this.events[t],function(t){t(e)}),"error"===t&&delete this.events[t]}},b={config:S,contextName:t,registry:k,defined:C,urlFetched:M,defQueue:A,Module:w,makeModuleMap:a,nextTick:req.nextTick,onError:c,configure:function(t){t.baseUrl&&"/"!==t.baseUrl.charAt(t.baseUrl.length-1)&&(t.baseUrl+="/");var e=S.pkgs,n=S.shim,i={paths:!0,config:!0,map:!0};eachProp(t,function(t,e){i[e]?"map"===e?(S.map||(S.map={}),mixin(S[e],t,!0,!0)):mixin(S[e],t,!0):S[e]=t}),t.shim&&(eachProp(t.shim,function(t,e){isArray(t)&&(t={deps:t}),!t.exports&&!t.init||t.exportsFn||(t.exportsFn=b.makeShimExports(t)),n[e]=t}),S.shim=n),t.packages&&(each(t.packages,function(t){var n;t="string"==typeof t?{name:t}:t,n=t.location,e[t.name]={name:t.name,location:n||t.name,main:(t.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),S.pkgs=e),eachProp(k,function(t,e){t.inited||t.map.unnormalized||(t.map=a(e))}),(t.deps||t.callback)&&b.require(t.deps||[],t.callback)},makeShimExports:function(t){function e(){var e;return t.init&&(e=t.init.apply(global,arguments)),e||t.exports&&getGlobal(t.exports)}return e},makeRequire:function(e,o){function r(n,i,u){var h,d,l;return o.enableBuildCallback&&i&&isFunction(i)&&(i.__requireJsBuild=!0),"string"==typeof n?isFunction(i)?c(makeError("requireargs","Invalid require call"),u):e&&hasProp(x,n)?x[n](k[e.id]):req.get?req.get(b,n,e,r):(d=a(n,e,!1,!0),h=d.id,hasProp(C,h)?C[h]:c(makeError("notloaded",'Module name "'+h+'" has not been loaded yet for context: '+t+(e?"":". Use require([])")))):(v(),b.nextTick(function(){v(),l=s(a(null,e)),l.skipMap=o.skipMap,l.init(n,i,u,{enabled:!0}),f()}),r)}return o=o||{},mixin(r,{isBrowser:isBrowser,toUrl:function(t){var i,o=t.lastIndexOf("."),r=t.split("/")[0],a="."===r||".."===r;return-1!==o&&(!a||o>1)&&(i=t.substring(o,t.length),t=t.substring(0,o)),b.nameToUrl(n(t,e&&e.id,!0),i,!0)},defined:function(t){return hasProp(C,a(t,e,!1,!0).id)},specified:function(t){return t=a(t,e,!1,!0).id,hasProp(C,t)||hasProp(k,t)}}),e||(r.undef=function(t){h();var n=a(t,e,!0),o=getOwn(k,t);i(t),delete C[t],delete M[n.url],delete O[t],o&&(o.events.defined&&(O[t]=o.events),d(t))}),r},enable:function(t){var e=getOwn(k,t.id);e&&s(t).enable()},completeLoad:function(t){var e,n,i,r=getOwn(S.shim,t)||{},a=r.exports;for(h();A.length;){if(n=A.shift(),null===n[0]){if(n[0]=t,e)break;e=!0}else n[0]===t&&(e=!0);p(n)}if(i=getOwn(k,t),!e&&!hasProp(C,t)&&i&&!i.inited){if(!(!S.enforceDefine||a&&getGlobal(a)))return o(t)?void 0:c(makeError("nodefine","No define call for "+t,null,[t]));p([t,r.deps||[],r.exportsFn])}f()},nameToUrl:function(t,e,n){var i,o,r,a,s,u,c,h,d;if(req.jsExtRegExp.test(t))h=t+(e||"");else{for(i=S.paths,o=S.pkgs,s=t.split("/"),u=s.length;u>0;u-=1){if(c=s.slice(0,u).join("/"),r=getOwn(o,c),d=getOwn(i,c)){isArray(d)&&(d=d[0]),s.splice(0,u,d);break}if(r){a=t===r.name?r.location+"/"+r.main:r.location,s.splice(0,u,a);break}}h=s.join("/"),h+=e||(/^data\:|\?/.test(h)||n?"":".js"),h=("/"===h.charAt(0)||h.match(/^[\w\+\.\-]+:/)?"":S.baseUrl)+h}return S.urlArgs?h+((-1===h.indexOf("?")?"?":"&")+S.urlArgs):h},load:function(t,e){req.load(b,t,e)},execCb:function(t,e,n,i){return e.apply(i,n)},onScriptLoad:function(t){if("load"===t.type||readyRegExp.test((t.currentTarget||t.srcElement).readyState)){interactiveScript=null;var e=m(t);b.completeLoad(e.id)}},onScriptError:function(t){var e=m(t);return o(e.id)?void 0:c(makeError("scripterror","Script error for: "+e.id,t,[e.id]))}},b.require=b.makeRequire(),b}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(t){return"interactive"===t.readyState?interactiveScript=t:void 0}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.9",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(t,e,n,i){var o,r,a=defContextName;return isArray(t)||"string"==typeof t||(r=t,isArray(e)?(t=e,e=n,n=i):t=[]),r&&r.context&&(a=r.context),o=getOwn(contexts,a),o||(o=contexts[a]=req.s.newContext(a)),r&&o.configure(r),o.require(t,e,n)},req.config=function(t){return req(t)},req.nextTick="undefined"!=typeof setTimeout?function(t){setTimeout(t,4)}:function(t){t()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(t){req[t]=function(){var e=contexts[defContextName];return e.require[t].apply(e,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(t,e,n){var i=t.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return i.type=t.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i},req.load=function(t,e,n){var i,o=t&&t.config||{};if(isBrowser)return i=req.createNode(o,e,n),i.setAttribute("data-requirecontext",t.contextName),i.setAttribute("data-requiremodule",e),!i.attachEvent||i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0||isOpera?(i.addEventListener("load",t.onScriptLoad,!1),i.addEventListener("error",t.onScriptError,!1)):(useInteractive=!0,i.attachEvent("onreadystatechange",t.onScriptLoad)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{importScripts(n),t.completeLoad(e)}catch(r){t.onError(makeError("importscripts","importScripts failed for "+e+" at "+n,r,[e]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(t){return head||(head=t.parentNode),dataMain=t.getAttribute("data-main"),dataMain?(mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0):void 0}),define=function(t,e,n){var i,o;"string"!=typeof t&&(n=e,e=t,t=null),isArray(e)||(n=e,e=null),!e&&isFunction(n)&&(e=[],n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(t,n){e.push(n)}),e=(1===n.length?["require"]:["require","exports","module"]).concat(e))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript(),i&&(t||(t=i.getAttribute("data-requiremodule")),o=contexts[i.getAttribute("data-requirecontext")])),(o?o.defQueue:globalDefQueue).push([t,e,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),function(t,e){"use strict";function n(t){return document.createElement(t)}function i(t,e){for(var n in e)try{t.style[n]=e[n]}catch(i){}return t}function o(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function r(t,e){if("array"!==o(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1}function a(){var t=arguments;for(var e in t[1])if(t[1].hasOwnProperty(e))switch(o(t[1][e])){case"object":t[0][e]=a({},t[0][e],t[1][e]);break;case"array":t[0][e]=t[1][e].slice(0);break;default:t[0][e]=t[1][e]}return t.length>2?a.apply(null,[t[0]].concat(Array.prototype.slice.call(t,2))):t[0]}function s(t,e,n){var i,o,r,a,s,c,h,d,l;return a=.5>=n?n*(1+e):n+e-n*e,0===a?"#000":(s=2*n-a,c=(a-s)/a,t=6*t,h=Math.floor(t),d=t-h,l=a*c*d,0===h||6===h?(i=a,o=s+l,r=s):1===h?(i=a-l,o=a,r=s):2===h?(i=s,o=a,r=s+l):3===h?(i=s,o=a-l,r=a):4===h?(i=s+l,o=s,r=a):(i=a,o=s,r=a-l),"#"+u(i)+u(o)+u(r))}function u(t){return t=Math.round(255*t).toString(16),1===t.length?"0"+t:t}function c(t,e,n,i){t.addEventListener?t[i?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[i?"detachEvent":"attachEvent"]("on"+e,n)}function h(t,u){function v(){for(L=W.history;L--;)X[L]=0===L?N.fps:X[L-1],Y[L]=0===L?N.duration:Y[L-1]}function y(t,e,n,i){return C[0|t][Math.round(Math.min((e-n)/(i-n)*U,U))]}function w(){_.legend.fps!==Q&&(_.legend.fps=Q,_.legend[p]=Q?"FPS":"ms"),T=Q?N.fps:N.duration,_.count[p]=T>999?"999+":T.toFixed(T>99?0:W.decimals)}function b(){if(M=d(),G<M-W.threshold&&(N.fps-=N.fps/Math.max(1,60*W.smoothing/W.interval),N.duration=1e3/N.fps),v(),w(),W.heat){if(q.length)for(L=q.length;L--;)q[L].el.style[A[q[L].name].heatOn]=Q?y(A[q[L].name].heatmap,N.fps,0,W.maxFps):y(A[q[L].name].heatmap,N.duration,W.threshold,0);if(_.graph&&A.column.heatOn)for(L=B.length;L--;)B[L].style[A.column.heatOn]=Q?y(A.column.heatmap,X[L],0,W.maxFps):y(A.column.heatmap,Y[L],W.threshold,0)}if(_.graph)for(j=0;j<W.history;j++)B[j].style.height=(Q?X[j]?Math.round(D/W.maxFps*Math.min(X[j],W.maxFps)):0:Y[j]?Math.round(D/W.threshold*Math.min(Y[j],W.threshold)):0)+"px"}function x(){W.interval<20?(I=f(x),b()):(I=setTimeout(x,W.interval),R=f(b))}function E(t){t=t||window.event,t.preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),N.toggle()}function S(){W.toggleOn&&c(_.container,W.toggleOn,E,1),t.removeChild(_.container)}function k(){if(A=h.theme[W.theme],C=A.compiledHeatmaps||[],!C.length&&A.heatmaps.length){for(j=0;j<A.heatmaps.length;j++)for(C[j]=[],L=0;U>=L;L++)C[j][L]=s(.33/U*L,A.heatmaps[j].saturation,A.heatmaps[j].lightness);A.compiledHeatmaps=C}}function P(){_.container&&S(),k(),_.container=i(n("div"),A.container),_.count=_.container.appendChild(i(n("div"),A.count)),_.legend=_.container.appendChild(i(n("div"),A.legend)),_.graph=W.graph?_.container.appendChild(i(n("div"),A.graph)):0,q.length=0;for(var e in _)_[e]&&A[e].heatOn&&q.push({name:e,el:_[e]});if(B.length=0,_.graph)for(_.graph.style.width=W.history*A.column.width+(W.history-1)*A.column.spacing+"px",L=0;L<W.history;L++)B[L]=_.graph.appendChild(i(n("div"),A.column)),B[L].style.position="absolute",B[L].style.bottom=0,B[L].style.right=L*A.column.width+L*A.column.spacing+"px",B[L].style.width=A.column.width+"px",B[L].style.height="0px";O(),w(),t.appendChild(_.container),_.graph&&(D=_.graph.clientHeight),W.toggleOn&&("click"===W.toggleOn&&(_.container.style.cursor="pointer"),c(_.container,W.toggleOn,E))}function O(){i(_.container,W)}"object"===o(t)&&t.nodeType===e&&(u=t,t=document.body),t||(t=document.body);var A,C,M,I,R,D,T,L,j,N=this,W=a({},h.defaults,u||{}),_={},B=[],U=100,q=[],H=0,F=W.threshold,z=0,G=d()-F,X=[],Y=[],Q="fps"===W.show;N.options=W,N.fps=0,N.duration=0,N.isPaused=0,N.tickStart=function(){z=d()},N.tick=function(){M=d(),H=M-G,F+=(H-F)/W.smoothing,N.fps=1e3/F,N.duration=G>z?F:M-z,G=M},N.pause=function(){return I&&(N.isPaused=1,clearTimeout(I),l(I),l(R),I=R=0),N},N.resume=function(){return I||(N.isPaused=0,x()),N},N.set=function(t,e){return W[t]=e,Q="fps"===W.show,-1!==r(t,g)&&P(),-1!==r(t,m)&&O(),N},N.showDuration=function(){return N.set("show","ms"),N},N.showFps=function(){return N.set("show","fps"),N},N.toggle=function(){return N.set("show",Q?"ms":"fps"),N},N.hide=function(){return N.pause(),_.container.style.display="none",N},N.show=function(){return N.resume(),_.container.style.display="block",N},N.destroy=function(){N.pause(),S(),N.tick=N.tickStart=function(){}},function(){P(),x()}()}var d;!function(){var e=t.performance;if(e&&(e.now||e.webkitNow)){var n=e.now?"now":"webkitNow";d=e[n].bind(e)}else d=function(){return+new Date}}();var l=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,f=t.requestAnimationFrame;!function(){for(var e=["moz","webkit","o"],n=0,i=0,o=e.length;o>i&&!l;++i)l=t[e[i]+"CancelAnimationFrame"]||t[e[i]+"CancelRequestAnimationFrame"],f=l&&t[e[i]+"RequestAnimationFrame"];l||(f=function(e){var i=d(),o=Math.max(0,16-(i-n));return n=i+o,t.setTimeout(function(){e(i+o)},o)},l=function(t){clearTimeout(t)})}();var p="string"===o(document.createElement("div").textContent)?"textContent":"innerText";h.extend=a,window.FPSMeter=h,h.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var g=["toggleOn","theme","heat","graph","history"],m=["position","zIndex","left","top","right","bottom","margin"]}(window),function(t,e,n){"use strict";e.theme={};var i=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},i,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},i,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},i,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},i,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter),function(){"use strict";var t=!1,e=[],n=window.requirejs,i=window.require,o=window.define,r={require:i,define:function(){var n=arguments[0];t&&e.push(n),o.apply(this,arguments)},refresh:function(){var t=0;for(t=0;t<e.length;++t)n.undef(e[t])},watch:function(){t=!0}};window.bento=window.bento||r,window.require=void 0,window.define=void 0}(),bento.define("audia",[],function(){var t=null;"function"==typeof AudioContext?t=new AudioContext:window.webkitAudioContext&&(t=new webkitAudioContext);var e,n=Boolean(t),i=0,o={},r=function(t){var e=++i;return o[e]=t,e},a=function(t,e,n){return Math.min(Math.max(Number(t),e),n)};if(n){var s={},u=function(e,n){var i=function(t){t.duration!==e._duration&&(e._duration=t.duration,e.dispatchEvent("durationchange")),e.dispatchEvent("canplay"),e.dispatchEvent("canplaythrough"),e.dispatchEvent("load"),e._autoplay&&e.play(),e._onload&&e.onload()};if(n in s)i(s[n]);else{var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=function(){t.decodeAudioData(o.response,function(t){s[n]=t,i(t)})},o.send()}},c=function(e){e.bufferSource=t.createBufferSource(),e.bufferSource.buffer=s[e.src],e.bufferSource.connect(e.gainNode),e.bufferSource.loop=e._loop,e.bufferSource.onended=e._onended},h=t.createGain();h.gain.value=1,h.connect(t.destination),e=function(e){this.id=r(this),this._listenerId=0,this._listeners={},this._autoplay=!1,this._buffered=[],this._currentSrc="",this._currentTime=0,this._defaultPlaybackRate=1,this._duration=NaN,this._loop=!1,this._muted=!1,this._paused=!0,this._playbackRate=1,this._played=[],this._preload="auto",this._seekable=[],this._seeking=!1,this._src="",this._volume=1,this._onended=null,this._onload=null,this.gainNode=t.createGain(),this.gainNode.gain.value=this._volume,this.gainNode.connect(h),void 0!==e&&(this.src=e)},e.prototype.load=function(){this._src&&u(this,this._src)},e.prototype.play=function(){this._paused=!1,c(this),this.bufferSource.start?this.bufferSource.start(0):this.bufferSource.noteOn(0)},e.prototype.pause=function(){this._paused||(this._paused=!0,this.bufferSource.stop?this.bufferSource.stop(0):this.bufferSource.noteOff(0))},e.prototype.stop=function(){this._paused||(this.pause(),this.currentTime=0)},e.prototype.addEventListener=function(t,e){this._listeners[++this._listenerKey]={eventName:t,callback:e}},e.prototype.dispatchEvent=function(t,e){for(var n in this._listeners){var i=this._listeners[n];i.eventName==t&&i.callback&&i.callback.apply(i.callback,e)}},e.prototype.removeEventListener=function(t,e){var n=null;for(var i in this._listeners){var o=this._listeners[i];if(o.eventName===t&&o.callback===e){n=i;break}}null!==n&&delete this._listeners[n]},Object.defineProperty(e.prototype,"autoplay",{get:function(){return this._autoplay},set:function(t){this._autoplay=t}}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._buffered}}),Object.defineProperty(e.prototype,"currentSrc",{get:function(){return this._currentSrc}}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._currentTime},set:function(t){this._currentTime=t}}),Object.defineProperty(e.prototype,"defaultPlaybackRate",{get:function(){return Number(this._defaultPlaybackRate)},set:function(t){this._defaultPlaybackRate=t}}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration}}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._loop!==t&&(this._loop=t,this.bufferSource&&(this._paused?(c(this),this.bufferSource.loop=t):(this.pause(),c(this),this.bufferSource.loop=t,this.play())))}}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(t){this._muted=t,this.gainNode.gain.value=t?0:this._volume}}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused}}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this._playbackRate},set:function(t){this._playbackRate=t}}),Object.defineProperty(e.prototype,"played",{get:function(){return this._played}}),Object.defineProperty(e.prototype,"preload",{get:function(){return this._preload},set:function(t){this._preload=t}}),Object.defineProperty(e.prototype,"seekable",{get:function(){return this._seekable}}),Object.defineProperty(e.prototype,"seeking",{get:function(){return this._seeking}}),Object.defineProperty(e.prototype,"src",{get:function(){return this._src},set:function(t){this._src=t,u(this,t)}}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){e.preventErrors||a(t,0,1)!==t,0>t&&(t=0),this._volume=t,this._muted||(this.gainNode.gain.value=t,this.dispatchEvent("volumechange"))}}),Object.defineProperty(e.prototype,"onended",{get:function(){return this._onended},set:function(t){this._onended=t}}),Object.defineProperty(e.prototype,"onload",{get:function(){return this._onload},set:function(t){this._onload=t}})}else e=function(t){this.id=r(this),this._audioNode=new Audio,void 0!==t&&(this.src=t)},e.prototype.load=function(t){this._audioNode.load()},e.prototype.play=function(t){void 0!==t&&(this._audioNode.currentTime=t),this._audioNode.play()},e.prototype.pause=function(){this._audioNode.pause()},e.prototype.stop=function(){this._audioNode.pause(),this._audioNode.currentTime=0},e.prototype.addEventListener=function(t,e,n){this._audioNode.addEventListener(t,e,n)},e.prototype.removeEventListener=function(t,e,n){this._audioNode.removeEventListener(t,e,n)},Object.defineProperty(e.prototype,"autoplay",{get:function(){return this._audioNode.autoplay},set:function(t){this._audioNode.autoplay=t}}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._audioNode.buffered}}),Object.defineProperty(e.prototype,"currentSrc",{get:function(){return this._audioNode.src}}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._audioNode.currentTime},set:function(t){this._audioNode.currentTime=t}}),Object.defineProperty(e.prototype,"defaultPlaybackRate",{get:function(){return this._audioNode.defaultPlaybackRate},set:function(t){this._audioNode.defaultPlaybackRate=t}}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._audioNode.duration}}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._audioNode.loop},set:function(t){this._audioNode.currentTime>=this._audioNode.duration&&(this._audioNode.currentTime=0),this._audioNode.loop=t}}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._audioNode.muted},set:function(t){this._audioNode.muted=t}}),Object.defineProperty(e.prototype,"paused",{get:function(){return this._audioNode.paused}}),Object.defineProperty(e.prototype,"playbackRate",{get:function(){return this._audioNode.playbackRate},set:function(t){this._audioNode.playbackRate=t}}),Object.defineProperty(e.prototype,"played",{get:function(){return this._audioNode.played}}),Object.defineProperty(e.prototype,"preload",{get:function(){return this._audioNode.preload},set:function(t){this._audioNode.preload=t}}),Object.defineProperty(e.prototype,"seekable",{get:function(){return this._audioNode.seekable}}),Object.defineProperty(e.prototype,"seeking",{get:function(){return this._audioNode.seeking}}),Object.defineProperty(e.prototype,"src",{get:function(){return this._audioNode.src},set:function(t){var e=this,n=function(){e.onload&&e.onload(),e._audioNode.removeEventListener("canplaythrough",n,!1)};this._audioNode.src=t,this._audioNode.preload="auto",this._audioNode.addEventListener("canplaythrough",n,!1),this._audioNode.addEventListener("error",function(t){console.log("audio load error",e._audioNode.error)},!1),this._audioNode.load()}}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._audioNode.volume},set:function(t){if(e.preventErrors)var t=a(t,0,1);this._audioNode.volume=t}}),Object.defineProperty(e.prototype,"onended",{
get:function(){return this._audioNode.onended},set:function(t){this._audioNode.onended=t}}),Object.defineProperty(e.prototype,"onload",{get:function(){return this._audioNode.onload},set:function(t){this._audioNode.onload=t}});e.preventErrors=!0,Object.defineProperty(e,"hasWebAudio",{get:function(){return n}}),Object.defineProperty(e,"audioContext",{get:function(){return t}}),Object.defineProperty(e,"gainNode",{get:function(){return h}}),Object.defineProperty(e,"version",{get:function(){return"0.3.0"}});var d;e.canPlayType=function(t){void 0===d&&(d=new Audio);var t=(null===t.match("/")?"audio/":"")+t;return d.canPlayType(t)},e.prototype.canPlayType=function(t){return e.canPlayType(t)};for(var l=["abort","canplay","canplaythrough","durationchange","emptied","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange"],f=0,p=l.length;p>f;++f)!function(t){var n="_on"+t;e.prototype[n]=null,Object.defineProperty(e.prototype,"on"+t,{get:function(){return this[n]},set:function(e){this[n]&&this.removeEventListener(t,this[n],!1),"function"==typeof e?(this[n]=e,this.addEventListener(t,e,!1)):this[n]=null}})}(l[f]);return e}),bento.define("bento",["bento/utils","bento/lib/domready","bento/eventsystem","bento/managers/asset","bento/managers/input","bento/managers/object","bento/managers/audio","bento/managers/screen","bento/managers/savestate","bento/math/vector2","bento/math/rectangle","bento/renderer"],function(t,e,n,i,o,r,a,s,u,c,h,d){"use strict";var l,f,p,g,m=0,v=1,y={x:1,y:1},w=!1,b={},x=new h(0,0,640,480),E=function(e){var n,i=e.pixelSize||1,o=window.devicePixelRatio||1;window.innerWidth*o,window.innerHeight*o;l=e.canvasElement||document.getElementById(e.canvasId),l||(n=document.getElementById("wrapper"),n||(n=document.body),l=document.createElement(t.isCocoonJS()?"screencanvas":"canvas"),l.id=e.canvasId,n.appendChild(l)),l.width=x.width*i,l.height=x.height*i,m=x.height/x.width},S=function(t,e){var n;t.renderer=t.renderer?t.renderer.toLowerCase():"canvas2d","canvas2d"===t.renderer?n="bento/renderers/canvas2d":"pixi"===t.renderer?n="bento/renderers/pixi":"auto"===t.renderer&&(console.log("WARNING: auto renderer is deprecated. Please use canvas2d or pixi as renderers."),n="bento/renderers/canvas2d"),new d(n,l,t,function(t){console.log("Init "+t.name+" as renderer"),f=t,b=O.getGameData(),e()})},k=function(){var t,e,n=window.innerWidth,i=window.innerHeight;g=i/n,m>g?(t=i/m,e=i):(t=n,e=n*m),l.style.width=t+"px",l.style.height=e+"px",y.x=t/x.width,y.y=e/x.height},P=function(t){var e=!1,i=function(t){var e=document.createElement("a"),n=document.createEvent("MouseEvents");e.href=t,n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!0,!1,!1,0,null),e.dispatchEvent(n)};navigator.isCocoonJS||window.Windows||window.ejecta||w&&(n.on(t,function(){e=!0}),n.on("postDraw",function(t){e&&(e=!1,i(l.toDataURL()))}))},O={setup:function(u,c){c=c||u.onComplete||u.onLoad,p=u,e(function(){var e=function(){O.objects.run(),c&&c()};if(u.canvasDimension){if(!u.canvasDimension.isRectangle)throw"settings.canvasDimension must be a rectangle";x=u.canvasDimension||x}u.sortMode=u.sortMode||0,E(u),S(u,function(){w=u.dev||!1,t.setDev(w),u.manualResize||(window.addEventListener("resize",k,!1),window.addEventListener("orientationchange",k,!1),k()),O.input=new o(b,u),O.objects=new r(O.getGameData,u),O.assets=new i,O.audio=new a(O),O.screens=new s,t.extend(O,O.objects),u.assetGroups?O.assets.loadAssetGroups(u.assetGroups,e):O.assets.loadAssetsJson(function(t){e()}),bento.watch(),u.reload&&(u.reload.simple&&n.on(u.reload.simple,function(){O.reload()}),u.reload.assets&&n.on(u.reload.assets,function(){O.assets.loadAssetsJson(function(t){O.assets.reload(O.reload)})}),u.reload.jump&&n.on(u.reload.jump,function(){var t=window.prompt("Show which screen?");O.screens.show(t)})),u.screenshot&&P(u.screenshot)})})},getSettings:function(){return p},getViewport:function(){return x},getCanvas:function(){return l},getRenderer:function(){return f},reload:function(t){var e;if(!O.screens)throw"Bento has not beens started yet.";return(e=O.screens.getCurrentScreen())?(O.screens.reset(),O.objects.resume(),O.objects.stop(),bento.refresh(),v=1,O.screens.show(t||e.name),void window.setTimeout(O.objects.run,120)):void console.log("WARNING: No screen has been loaded.")},getGameData:function(){return{canvas:l,renderer:f,canvasScale:y,viewport:x,entity:null,event:null,deltaT:0,speed:v}},getGameSpeed:function(){return v},setGameSpeed:function(t){v=t},isDev:function(){return w},assets:null,objects:null,input:null,audio:null,screens:null,saveState:u,utils:t};return O}),bento.define("bento/entity",["bento","bento/utils","bento/math/vector2","bento/math/rectangle","bento/math/transformmatrix","bento/transform"],function(t,e,n,i,o,r){"use strict";var a=function(t){var e;for(e=t.components.length-1;e>=0;--e)t.components[e]||t.components.splice(e,1)},s=0,u=function(o){if(!(this instanceof u))return new u(o);var a;if(this.id=s++,this.z=0,this.rootIndex=-1,this.timer=0,this.global=!1,this["float"]=!1,this.updateWhenPaused=0,this.name="",this.isAdded=!1,this.position=new n(0,0),this.origin=new n(0,0),this.family=[],this.components=[],this.dimension=new i(0,0,0,0),this.boundingBox=o.boundingBox||null,this.scale=new n(1,1),this.rotation=0,this.alpha=1,this.visible=!0,this.transform=new r(this),this.parent=null,this.settings=o,o){if(o.position&&(this.position=o.position),o.origin&&(this.origin=o.origin),o.dimension&&(this.dimension=o.dimension),o.scale&&(this.scale=o.scale),o.name&&(this.name=o.name),o.family)for(e.isArray(o.family)||(o.family=[o.family]),a=0;a<o.family.length;++a)this.family.push(o.family[a]);if(e.isDefined(o.alpha)&&(this.alpha=o.alpha),e.isDefined(o.rotation)&&(this.rotation=o.rotation),this.z=o.z||0,this.updateWhenPaused=o.updateWhenPaused||0,this.global=o.global||!1,this["float"]=o["float"]||!1,o.components)for(e.isArray(o.components)||(o.components=[o.components]),a=0;a<o.components.length;++a)this.attach(o.components[a]);o.originRelative&&this.setOriginRelative(o.originRelative),o.init&&o.init.apply(this),o.addNow&&t.objects.add(this)}};u.prototype.isEntity=function(){return!0},u.prototype.extend=function(t){return e.extend(this,t)};var c=function(t,e){var n=e.clone(),i=t.position,o=t.scale;return n.x*=Math.abs(o.x),n.y*=Math.abs(o.y),n.width*=Math.abs(o.x),n.height*=Math.abs(o.y),n.x+=i.x,n.y+=i.y,n};return u.prototype.getBoundingBox=function(){var t,e,o,r,a;return this.boundingBox?c(this,this.boundingBox):(t=this.scale?this.scale:new n(1,1),e=this.position.x-this.origin.x*t.x,r=this.position.y-this.origin.y*t.y,o=this.position.x+(this.dimension.width-this.origin.x)*t.x,a=this.position.y+(this.dimension.height-this.origin.y)*t.y,t.x<0&&(o=[e,e=o][0]),t.y<0&&(a=[r,r=a][0]),new i(e,r,o-e,a-r))},u.prototype.setOriginRelative=function(t){this.origin.x=t.x*this.dimension.width,this.origin.y=t.y*this.dimension.height},u.prototype.attach=function(n,i){var o=this,r=t.getGameData();if(!n)return void e.log("ERROR: trying to attach "+n);if(!i&&(n.isAdded||n.parent))return void e.log("ERROR: Child "+n.name+" was already attached.");if(r.entity=this,n.parent=this,n.rootIndex=this.components.length,this.components.push(n),n.attached&&n.attached(r),this.isAdded)n.start&&n.start(r);else for(o.parent&&(o=o.parent);o;){if(o.isAdded){n.start&&n.start(r);break}o=o.parent}return this},u.prototype.remove=function(e){var n,i=this,o=t.getGameData();if(e){if(n=this.components.indexOf(e),n>=0){if(this.isAdded)e.destroy&&e.destroy(o);else for(i.parent&&(i=i.parent);i;){if(i.isAdded){e.destroy&&e.destroy(o);break}i=i.parent}e.removed&&e.removed(o),e.parent=null,e.rootIndex=-1,this.components[n]=null}return this}},u.prototype.removeByName=function(t){var e=this;return e.getComponent(t,function(t){e.remove(t)}),this},u.prototype.removeSelf=function(e){var n=this;return n.parent?n.parent.remove(n):n.isAdded&&t.objects.remove(n),this},u.prototype.getComponent=function(t,e){var n,i,o;for(n=0,i=this.components.length;i>n;++n)if(o=this.components[n],o&&o.name===t)return e&&e.apply(o,[o,n]),o;return null},u.prototype.moveComponentTo=function(t,e){var n;t&&(n=this.components.indexOf(t),n>=0&&(this.components.splice(n,1),this.components.splice(e,0,t)))},u.prototype.collidesWith=function(i,o,r){var a,s,u,h,d,l,f=[],p=new n(0,0),g=!0,m=null,v=i.withComponent;if(i.isEntity)f=[i],p=o||p,d=r;else if(e.isArray(i))f=i,p=o||p,d=r;else if(p=i.offset||p,e.isDefined(i.firstOnly)&&(g=i.firstOnly),d=i.onCollide,i.entity){if(!i.entity.isEntity)return e.log("WARNING: settings.entity is not an entity"),null;f=[i.entity]}else if(i.entities){if(!e.isArray(i.entities))return e.log("WARNING: settings.entities is not an array"),null;f=i.entities}else i.name?f=t.objects.getByName(i.name):i.family?f=t.objects.getByFamily(i.family):i.rectangle&&(f=[i.rectangle]);if(!f.length)return null;for(a=this.getBoundingBox().offset(p),u=0;u<f.length;++u){if(h=f[u],h.isEntity){if(h.id===this.id)continue;if(v){if(l=h.getComponent(v),!l)return void e.log("ERROR: component "+v+" does not exist");if(!l.boundingBox)return void e.log("ERROR: component "+v+" does not have a boundingBox");s=c(h,l.boundingBox)}else s=h.getBoundingBox()}else h.isRectangle&&(s=h);if(a.intersect(s)){if(d&&d(h),g)return h;m=m||[],m.push(h)}}return m},u.prototype.collidesWithGroup=function(t,i,o){var r,a,s,u,c,h;if(e.isArray(t)||e.isDefined(i)||e.isDefined(o)?(u=t,c=i||new n(0,0),h=o):(u=t.other,c=t.offset,h=t.onCollide),!e.isArray(u))return void e.log("ERROR: Collision check must be with an Array of object");if(!u.length)return null;for(s=this.getBoundingBox().offset(c),r=0;r<u.length;++r)if(a=u[r],(!a.id||a.id!==this.id)&&a.getBoundingBox&&s.intersect(a.getBoundingBox()))return h&&h(a),a;return null},u.prototype.getWorldPosition=function(){return this.transform.getWorldPosition()},u.prototype.getLocalPosition=function(t){return this.transform.getLocalPosition(t)},u.prototype.start=function(e){var n,i,o;for(e=e||t.getGameData(),n=0,i=this.components.length;i>n;++n)o=this.components[n],o&&o.start&&(e.entity=this,o.start(e))},u.prototype.destroy=function(e){var n,i,o,r=this.components;for(e=e||t.getGameData(),n=0,i=r.length;i>n;++n)o=r[n],o&&o.destroy&&(e.entity=this,o.destroy(e))},u.prototype.update=function(e){var n,i,o,r=this.components;for(e=e||t.getGameData(),n=0,i=r.length;i>n;++n)o=r[n],o&&o.update&&(e.entity=this,o.rootIndex=n,o.update(e));this.timer+=e.speed,a(this)},u.prototype.draw=function(e){var n,i,o,r=this.components;if(this.visible){for(e=e||t.getGameData(),this.transform.draw(e),n=0,i=r.length;i>n;++n)o=r[n],o&&o.draw&&(e.entity=this,o.draw(e));for(n=r.length-1;n>=0;n--)o=r[n],o&&o.postDraw&&(e.entity=this,o.postDraw(e));this.transform.postDraw(e)}},u.prototype.attached=function(e){var n,i,o;for(e=e||t.getGameData(),e.entity=this,e.parent=this.parent,n=0,i=this.components.length;i>n;++n)o=this.components[n],o&&o.onParentAttached&&(e.entity=this,o.onParentAttached(e))},u.prototype.removed=function(e){var n,i,o;for(e=e||t.getGameData(),e.entity=this,e.parent=this.parent,n=0,i=this.components.length;i>n;++n)o=this.components[n],o&&o.onParentRemoved&&(e.entity=this,o.onParentRemoved(e))},u.prototype.collided=function(t){var e,n,i;if(!t)throw"Must pass a data object";for(t.entity=this,t.parent=this.parent,e=0,n=this.components.length;n>e;++e)i=this.components[e],i&&i.onParentCollided&&(t.entity=this,i.onParentCollided(t));this.onCollide&&this.onCollide(t.other)},u.prototype.toString=function(){return"[object Entity]"},u}),bento.define("bento/eventsystem",["bento/utils"],function(t){var e=!1,n={},i=[],o=function(){var o,r,a,s,u,c;if(!e){for(r=0;r<i.length;++r)if(s=i[r].eventName,i[r].reset!==!0){if(u=i[r].callback,c=i[r].context,!t.isUndefined(n[s]))for(a=n[s],o=a.length-1;o>=0;--o)if(a[o].callback===u){if(!c){n[s].splice(o,1);break}if(a[o].context===c){n[s].splice(o,1);break}}}else n[s]=[];i=[]}},r=function(e,i,o){t.isUndefined(n[e])&&(n[e]=[]),n[e].push({callback:i,context:o})},a=function(t,r,a){var s=n[t];s&&0!==s.length&&(i.push({eventName:t,callback:r,context:a}),e||o())},s=function(t){var r=n[t];r&&0!==r.length&&(i.push({eventName:t,reset:!0}),e||o())},u=!1,c={SortedEventSystem:null,suppressWarnings:!1,stopPropagation:function(){u=!0;var t=c.SortedEventSystem;t&&t.stopPropagation()},fire:function(i,r){var a,s,h,d,l=c.SortedEventSystem;if(l&&l.fire(i,r),u=!1,o(),t.isString(i)||(i=i.toString()),!t.isUndefined(n[i])){for(h=n[i],a=0,s=h.length;s>a;++a)if(e=!0,d=h[a],d?d.context?d.callback.apply(d.context,[r]):d.callback(r):!this.suppressWarnings,u){u=!1;break}e=!1}},addEventListener:r,removeEventListener:a,on:r,off:a,clear:s};return c}),bento.define("bento/packedimage",["bento/math/rectangle"],function(t){return function(e,n){var i=n?new t(n.x,n.y,n.w,n.h):new t(0,0,e.width,e.height);return i.image=e,i}}),bento.define("bento/profiler",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(t,e,n,i,o,r,a,s,u){"use strict";var c=0,h=0,d=0,l={},f={},p={},g=0,m=!1,v=function(){m=!0,h=window.performance.now()},y=function(){d+=window.performance.now()-h,g+=1,this.reportAfter&&g>this.reportAfter&&(g=0,this.report()),m=!1},w=function(){var t;console.log("== Report for time spent =="),console.log("Total time:",d.toFixed(2)+"ms");for(t in f)f.hasOwnProperty(t)&&console.log(t,"\n  "+f[t].toFixed(2)+"ms","\n  "+(f[t]/d*100).toFixed(0)+"%","\n  "+p[t]+" tics")},b=function(t){m&&(t?(l[t]=window.performance.now(),f[t]=f[t]||0,p[t]=p[t]||0):c=window.performance.now())},x=function(t,e){m&&(e&&(t?console.log(t,window.performance.now()-l[t]):console.log(window.performance.now()-c)),f[t]+=window.performance.now()-l[t],p[t]+=1)};return{reportAfter:10,start:v,stop:y,report:w,tic:b,toc:x}}),bento.define("bento/renderer",["bento/utils"],function(t){return function(e,n,i,o){var r={save:function(){},restore:function(){},setTransform:function(t,e,n,i,o,r){},translate:function(){},scale:function(t,e){},rotate:function(t){},fillRect:function(t,e,n,i,o){},fillCircle:function(t,e,n,i){},strokeRect:function(t,e,n,i,o){},drawLine:function(t,e,n,i,o,r){},drawImage:function(t,e,n,i,o,r,a,s,u){},begin:function(){},flush:function(){},setColor:function(){},getOpacity:function(){},setOpacity:function(){},createSurface:function(){},setContext:function(){},restoreContext:function(){}};bento.require([e],function(e){t.extend(r,e(n,i),!0),o(r)})}}),bento.define("bento/transform",["bento","bento/math/vector2","bento/math/transformmatrix"],function(t,e,n){"use strict";var i=2*Math.PI,o=function(t){return this instanceof o?(this.matrix=new n,this.entity=t,this.sin=0,this.cos=1,this.rotationCache=0,this.oldAlpha=1,this.x=0,void(this.y=0)):new o(t)};return o.prototype.draw=function(t){var e=this.entity,n=(this.matrix,e.alpha),r=e.rotation,a=this.sin,s=this.cos,u=t.renderer,c=t.viewport;r!==this.rotationCache&&(this.rotationCache=r,this.sin=Math.sin(r),this.cos=Math.cos(r),a=this.sin,s=this.cos),u.save(),o.subPixel?u.translate(e.position.x+this.x,e.position.y+this.y):u.translate(Math.round(e.position.x+this.x),Math.round(e.position.y+this.y)),e.parent||e["float"]||u.translate(-c.x,-c.y),e.rotation%i&&u.rotate(r,a,s),u.scale(e.scale.x,e.scale.y),this.oldAlpha=t.renderer.getOpacity(),u.setOpacity(this.oldAlpha*n)},o.prototype.postDraw=function(t){var e=t.renderer;e.setOpacity(this.oldAlpha),e.restore()},o.prototype.getWorldPosition=function(){var e,i,o,r,a=this.entity,s=[],u=!1;if(!a.parent)return a["float"]?a.position.add(t.getViewport().getCorner()):a.position.clone();for(o=a;o.parent;)o=o.parent,s.push(o);for(s.length&&s[s.length-1]["float"]&&(u=!0),e=a["float"]||u?a.position.add(t.getViewport().getCorner()):a.position.clone(),r=s.length-1;r>=0;--r)o=s[r],i=(new n).scale(o.scale.x,o.scale.y),i.multiplyWithVector(e),i=(new n).rotate(o.rotation),i.multiplyWithVector(e),i=(new n).translate(o.position.x,o.position.y),i.multiplyWithVector(e);return e},o.prototype.getLocalPosition=function(e){var i,o,r,a,s,u=this.entity,c=[],h=!1;if(!u.parent)return u["float"]?e.subtract(t.getViewport().getCorner()):e;for(a=u;a.parent;)a=a.parent,c.push(a);for(c.length&&c[c.length-1]["float"]&&(h=!0),i=u["float"]||h?e.subtract(t.getViewport().getCorner()):e.clone(),s=c.length-1;s>=0;--s)a=c[s],r=a.position,o=(new n).translate(-r.x,-r.y),o.multiplyWithVector(i),o=(new n).rotate(-a.rotation),o.multiplyWithVector(i),o=(new n).scale(1/a.scale.x,1/a.scale.y),o.multiplyWithVector(i);return i},o.subPixel=!0,o}),bento.define("bento/utils",[],function(){"use strict";var t,e=!1,n=function(t){return"string"==typeof t||t instanceof String},i=Array.prototype.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},o=function(t){return"[object Object]"===Object.prototype.toString.call(t)},r=function(t){return"[object Function]"===Object.prototype.toString.call(t)},a=function(t){return"[object Number]"===Object.prototype.toString.call(t)},s=function(t){return t===!0||t===!1||"[object Boolean]"===Object.prototype.toString.call(t)},u=function(t){return parseFloat(t)===parseInt(t,10)&&!isNaN(t)},c=function(t){return void 0===t},h=function(t){return void 0!==t},d=function(t){return null==t},l=function(t){return null!=t},f=function(t){var e=t;return"object"!=typeof t||null===t?!1:function(){for(;;)if(null===Object.getPrototypeOf(e=Object.getPrototypeOf(e)))break;return Object.getPrototypeOf(t)===e}()},p=function(t,e){var n=t.indexOf(e);return n>=0?(t.splice(n,1),!0):!1},g=function(t,e,n,i){var o,r;for(o in e)e.hasOwnProperty(o)&&(t.hasOwnProperty(o)&&!n&&(t.base=t.base||{},r={},r[o]=t[o],g(t.base,r),i&&i(o)),f(e[o])?t[o]=g({},e[o]):t[o]=e[o]);return t},m=function(t){return Object.keys(t).length},v=function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n},y=function(){var t=function(t,n){return e(t.slice(),n)},e=function(t,e){"function"!=typeof e&&(e=function(t,e){return String(t).localeCompare(e)});var i=t.length;if(1>=i)return t;for(var o=new Array(i),r=1;i>r;r*=2){n(t,e,r,o);var a=t;t=o,o=a}return t},n=function(t,e,n,i){var o,r,a,s,u,c=t.length,h=0,d=2*n;for(o=0;c>o;o+=d)for(r=o+n,a=r+n,r>c&&(r=c),a>c&&(a=c),s=o,u=r;;)if(r>s&&a>u)e(t[s],t[u])<=0?i[h++]=t[s++]:i[h++]=t[u++];else if(r>s)i[h++]=t[s++];else{if(!(a>u))break;i[h++]=t[u++]}};return t.inplace=function(t,i){var o=e(t,i);return o!==t&&n(o,null,t.length,t),t},t}(),w=function(){var t,e={3:["cancel"],8:["backspace"],9:["tab"],12:["clear"],13:["enter"],16:["shift"],17:["ctrl"],18:["alt","menu"],19:["pause","break"],20:["capslock"],27:["escape","esc"],32:["space","spacebar"],33:["pageup"],34:["pagedown"],35:["end"],36:["home"],37:["left"],38:["up"],39:["right"],40:["down"],41:["select"],42:["printscreen"],43:["execute"],44:["snapshot"],45:["insert","ins"],46:["delete","del"],47:["help"],91:["command","windows","win","super","leftcommand","leftwindows","leftwin","leftsuper"],92:["command","windows","win","super","rightcommand","rightwindows","rightwin","rightsuper"],145:["scrolllock","scroll"],186:["semicolon",";"],187:["equal","equalsign","="],188:["comma",","],189:["dash","-"],190:["period","."],191:["slash","forwardslash","/"],192:["graveaccent","`"],195:["GamepadA"],196:["GamepadB"],197:["GamepadX"],198:["GamepadY"],199:["GamepadRightShoulder"],200:["GamepadLeftShoulder"],201:["GamepadLeftTrigger"],202:["GamepadRightTrigger"],203:["GamepadDPadUp"],204:["GamepadDPadDown"],205:["GamepadDPadLeft"],206:["GamepadDPadRight"],207:["GamepadMenu"],208:["GamepadView"],209:["GamepadLeftThumbstick"],210:["GamepadRightThumbstick"],211:["GamepadLeftThumbstickUp"],212:["GamepadLeftThumbstickDown"],213:["GamepadLeftThumbstickRight"],214:["GamepadLeftThumbstickLeft"],215:["GamepadRightThumbstickUp"],216:["GamepadRightThumbstickDown"],217:["GamepadRightThumbstickRight"],218:["GamepadRightThumbstickLeft"],7:["GamepadXboxButton"],219:["openbracket","["],220:["backslash","\\"],221:["closebracket","]"],222:["apostrophe","'"],48:["zero","0"],49:["one","1"],50:["two","2"],51:["three","3"],52:["four","4"],53:["five","5"],54:["six","6"],55:["seven","7"],56:["eight","8"],57:["nine","9"],96:["numzero","num0"],97:["numone","num1"],98:["numtwo","num2"],99:["numthree","num3"],100:["numfour","num4"],101:["numfive","num5"],102:["numsix","num6"],103:["numseven","num7"],104:["numeight","num8"],105:["numnine","num9"],106:["nummultiply","num*"],107:["numadd","num+"],108:["numenter"],109:["numsubtract","num-"],110:["numdecimal","num."],111:["numdivide","num/"],144:["numlock","num"],112:["f1"],113:["f2"],114:["f3"],115:["f4"],116:["f5"],117:["f6"],118:["f7"],119:["f8"],120:["f9"],121:["f10"],122:["f11"],123:["f12"],174:["volDown"],175:["volUp"]};for(t=65;90>=t;t+=1)e[t]=String.fromCharCode(t+32);return e}(),b=function(){var t={0:["A","a","click"],2:["X","x","play","pause"],12:["up"],13:["down"],14:["left"],15:["right"],16:["menu"]};return t}(),x=function(){var t={0:["A","a"],1:["B","b"],2:["X","x"],3:["Y","y"],4:["L1","l1"],5:["R1","r1"],6:["L2","l2"],7:["R2","r2"],8:["back","select"],9:["start"],10:["right-thumb","right-stick"],11:["left-thumb","left-stick"],12:["up"],13:["down"],14:["left"],15:["right"],16:["menu","home"]};return t}();return t={isString:n,isArray:i,isObject:o,isFunction:r,isNumber:a,isBoolean:s,isInt:u,isUndefined:c,isDefined:h,isEmpty:d,isNotEmpty:l,removeFromArray:p,extend:g,getKeyLength:m,copyObject:v,stableSort:y,keyboardMapping:w,remoteMapping:b,gamepadMapping:x,getDefault:function(t,e){return void 0!==t?t:e},getRandom:function(t){return Math.floor(Math.random()*t)},getRandomRange:function(t,e){var n=e-t;return t+Math.floor(Math.random()*n)},getRandomFloat:function(t){return Math.random()*t},getRandomRangeFloat:function(t,e){var n=e-t;return t+Math.random()*n},toRadian:function(t){return t*Math.PI/180},toDegree:function(t){return t/Math.PI*180},sign:function(t){return t>0?1:0>t?-1:0},approach:function(t,e,n){return n=Math.abs(n),e>t?Math.min(t+n,e):Math.max(t-n,e)},repeat:function(e,n,i){var o,r,a;if("number"==typeof e?(r=e,a=n):(r=n,a=e),!a.apply)return void t.log("Did not pass a function");for(o=0;r>o;++o)i?a.apply(window,i):a()},checksum:function(t){var e,n,i=0,o=(t||"").length;if(0===o)return i;for(e=0;o>e;++e)n=t.charCodeAt(e),i=(i<<5)-i+n,i&=i;return i},cloneJson:function(t){var e;try{e=JSON.parse(JSON.stringify(t))}catch(n){e={},console.log("WARNING: object cloning failed")}return e},forEach:function(e,n){var i,o,r=!1,a=function(){r=!0};if(t.isArray(e)){for(i=0,o=e.length;o>i;++i)if(n(e[i],i,o,a,e[i+1]),r)return}else{o=t.getKeyLength(e);for(i in e)if(e.hasOwnProperty(i)&&(n(e[i],i,o,a),r))return}},isBetween:function(t,e,n,i){return i?e>=t&&n>=e:e>t&&n>e},pickRandom:function(){return arguments[this.getRandom(arguments.length)]},clamp:function(t,e,n){return Math.max(t,Math.min(e,n))},isApple:function(){var t=navigator.userAgent.match(/iPhone|iPad|iPod/i);return/iPhone/i.test(t)||/iPad/i.test(t)||/iPod/i.test(t)},isAndroid:function(){return/Android/i.test(navigator.userAgent)},isCocoonJS:function(){return navigator.isCocoonJS},isCocoonJs:function(){return navigator.isCocoonJS},isMobileBrowser:function(){var t=!1;return function(e){(/(android|bb\d+|meego|android|ipad|playbook|silk).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t},isNativeIos:function(){return navigator.isCocoonJS&&window.Cocoon&&"ios"===window.Cocoon.getPlatform()?!0:!1},isNativeAndroid:function(){var t;return navigator.isCocoonJS&&window.Cocoon&&(t=window.Cocoon.getPlatform(),"android"===t||"amazon"===t)?!0:!1},isAndroidDevice:function(){var t=window.device&&window.device.platform?window.device.platform.toLowerCase():"";return"android"===t?!0:!1},isIosDevice:function(){var t=window.device&&window.device.platform?window.device.platform.toLowerCase():"";return"ios"===t?!0:!1},isAmazonDevice:function(){var t=window.device&&window.device.platform?window.device.platform.toLowerCase():"";return t.indexOf("amazon")>-1?!0:!1},setDev:function(t){e=t},isDev:function(){return e},log:function(t){console.error(t)},SortMode:{ALWAYS:0,NEVER:1,SORT_ON_ADD:2}}}),bento.define("bento/components/clickable",["bento","bento/utils","bento/math/vector2","bento/math/transformmatrix","bento/eventsystem","bento/sortedeventsystem"],function(t,e,n,i,o,r){"use strict";var a=[],s=function(e){var n=0;if(!t.objects||!e)return!1;for(n=e.updateWhenPaused;e.parent;)e=e.parent,n=e.updateWhenPaused;return n<t.objects.isPaused()},u=function(t){if(!(this instanceof u))return new u(t);var n=function(){};this.entity=null,this.parent=null,this.rootIndex=-1,this.name="clickable",this.isHovering=!1,this.hasTouched=!1,this.ignorePauseDuringPointerUpEvent=t&&e.isDefined(t.ignorePauseDuringPointerUpEvent)?t.ignorePauseDuringPointerUpEvent:!0,this.holdId=null,this.isPointerDown=!1,this.initialized=!1,this.sort=t.sort||!1,this.callbacks={pointerDown:t.pointerDown||n,pointerUp:t.pointerUp||n,pointerMove:t.pointerMove||n,onClick:t.onClick||n,onClickUp:t.onClickUp||n,onClickMiss:t.onClickMiss||n,onHold:t.onHold||n,onHoldLeave:t.onHoldLeave||n,onHoldEnter:t.onHoldEnter||n,onHoldEnd:t.onHoldEnd||n,onHoverLeave:t.onHoverLeave||n,onHoverEnter:t.onHoverEnter||n},this.clickables=a};return u.prototype.destroy=function(){var t=a.indexOf(this),e=0,n=0;for(t>-1&&(a[t]=null),e=0,n=a.length;n>e&&!a[e];++e)e===n-1&&(a.length=0);this.sort?(r.off("pointerDown",this.pointerDown,this),r.off("pointerUp",this.pointerUp,this),r.off("pointerMove",this.pointerMove,this)):(o.off("pointerDown",this.pointerDown,this),o.off("pointerUp",this.pointerUp,this),o.off("pointerMove",this.pointerMove,this)),this.initialized=!1},u.prototype.start=function(){this.initialized||(a.push(this),this.sort?(r.on(this,"pointerDown",this.pointerDown,this),r.on(this,"pointerUp",this.pointerUp,this),r.on(this,"pointerMove",this.pointerMove,this)):(o.on("pointerDown",this.pointerDown,this),o.on("pointerUp",this.pointerUp,this),o.on("pointerMove",this.pointerMove,this)),this.initialized=!0)},u.prototype.update=function(){this.isHovering&&this.isPointerDown&&this.callbacks.onHold&&this.callbacks.onHold()},u.prototype.cloneEvent=function(t){return{id:t.id,position:t.position.clone(),eventType:t.eventType,localPosition:t.localPosition.clone(),worldPosition:t.worldPosition.clone(),diffPosition:t.diffPosition?t.diffPosition.clone():void 0}},u.prototype.pointerDown=function(t){var e=this.transformEvent(t);s(this.entity)||(this.isPointerDown=!0,this.callbacks.pointerDown&&this.callbacks.pointerDown.call(this,e),this.entity.getBoundingBox&&this.checkHovering(e,!0))},u.prototype.pointerUp=function(t){var e,n=this.transformEvent(t);(this.ignorePauseDuringPointerUpEvent||!s(this.entity))&&(e=n.localPosition,this.isPointerDown=!1,this.callbacks.pointerUp&&this.callbacks.pointerUp.call(this,n),this.entity.getBoundingBox().hasPosition(e)&&(this.callbacks.onClickUp.call(this,[n]),this.hasTouched&&this.holdId===n.id&&(this.holdId=null,this.callbacks.onHoldEnd.call(this,n))),this.hasTouched=!1)},u.prototype.pointerMove=function(t){var e=this.transformEvent(t);s(this.entity)||(this.callbacks.pointerMove&&this.callbacks.pointerMove.call(this,e),this.entity.getBoundingBox&&this.checkHovering(e))},u.prototype.checkHovering=function(t,e){var n=t.localPosition;this.entity.getBoundingBox().hasPosition(n)?(this.hasTouched&&!this.isHovering&&this.holdId===t.id&&this.callbacks.onHoldEnter.call(this,t),this.isHovering||this.callbacks.onHoverEnter.call(this,t),this.isHovering=!0,e&&(this.hasTouched=!0,this.holdId=t.id,this.callbacks.onClick.call(this,t))):(this.hasTouched&&this.isHovering&&this.holdId===t.id&&this.callbacks.onHoldLeave.call(this,t),this.isHovering&&this.callbacks.onHoverLeave.call(this,t),this.isHovering=!1,e&&this.callbacks.onClickMiss.call(this,t))},u.prototype.transformEvent=function(t){return t.localPosition=this.entity.getLocalPosition(t.worldPosition),t},u.prototype.attached=function(t){this.entity=t.entity},u.prototype.toString=function(){return"[object Clickable]"},u}),bento.define("bento/components/fill",["bento/utils","bento"],function(t,e){"use strict";var n=function(t){if(!(this instanceof n))return new n(t);var i=e.getViewport();t=t||{},this.parent=null,this.rootIndex=-1,this.name="fill",this.color=t.color||[0,0,0,1],this.dimension=t.dimension||i};return n.prototype.draw=function(t){var e=this.dimension;t.renderer.fillRect(this.color,e.x,e.y,e.width,e.height)},n.prototype.setup=function(t){this.color=t.color},n.prototype.toString=function(){return"[object Fill]"},n}),bento.define("bento/components/nineslice",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/eventsystem","bento/utils","bento/tween"],function(t,e,n,i,o,r,a){"use strict";var s=function(t){return this instanceof s?(this.entity=null,this.parent=null,this.rootIndex=-1,this.name="nineslice",this.visible=!0,this.width=0,this.height=0,this.spriteImage=null,this.padding=0,this.sliceWidth=0,this.sliceHeight=0,void this.setup(t)):new s(t)};return s.prototype.setup=function(e){var n=this;if(e.image)this.spriteImage=e.image;else if(e.imageName){if(!t.assets)throw"Bento asset manager not loaded";this.spriteImage=t.assets.getImage(e.imageName)}else{if(!e.imageFromUrl)return;if(!this.spriteImage&&t.assets)return void t.assets.loadImageFromUrl(e.imageFromUrl,e.imageFromUrl,function(i,o){n.spriteImage=t.assets.getImage(e.imageFromUrl),n.setup(e),e.onLoad&&e.onLoad()})}this.padding=e.padding||0,this.spriteImage&&(this.sliceWidth=Math.floor((this.spriteImage.width-2*this.padding)/3),this.sliceHeight=Math.floor((this.spriteImage.height-2*this.padding)/3)),e.width&&(this.width=Math.max(e.width||0,2*this.sliceWidth)),e.height&&(this.height=Math.max(e.height||0,2*this.sliceHeight)),this.entity&&(this.entity.dimension.width=this.width,this.entity.dimension.height=this.height)},s.prototype.attached=function(t){this.entity=t.entity,this.entity.dimension.width=this.width,this.entity.dimension.height=this.height},s.prototype.setWidth=function(t){if(this.width=r.isDefined(t)?t:this.width,
this.width=Math.max(this.width,2*this.sliceWidth),this.entity){var e=this.entity.origin.x/this.entity.dimension.width;this.entity.dimension.width=this.width,this.entity.origin.x=e*this.width}},s.prototype.setHeight=function(t){if(this.height=r.isDefined(t)?t:this.height,this.height=Math.max(this.height,2*this.sliceHeight),this.entity){var e=this.entity.origin.y/this.entity.dimension.height;this.entity.dimension.height=this.height,this.entity.origin.y=e*this.height}},s.prototype.fillArea=function(t,e,n,i,o,r){var a=(this.sliceWidth+this.padding)*(e%3),s=(this.sliceHeight+this.padding)*Math.floor(e/3);0!==o&&0!==r&&(o||(o=this.sliceWidth),r||(r=this.sliceHeight),t.drawImage(this.spriteImage,a,s,this.sliceWidth,this.sliceHeight,n,i,o,r))},s.prototype.draw=function(t){var e=(t.entity,t.entity.origin),n=this.width-2*this.sliceWidth,i=this.height-2*this.sliceHeight;0!==this.width&&0!==this.height&&(t.renderer.translate(-Math.round(e.x),-Math.round(e.y)),this.fillArea(t.renderer,0,0,0),this.fillArea(t.renderer,1,this.sliceWidth,0,n,this.sliceHeight),this.fillArea(t.renderer,2,this.width-this.sliceWidth,0),this.fillArea(t.renderer,3,0,this.sliceHeight,this.sliceWidth,i),this.fillArea(t.renderer,4,this.sliceWidth,this.sliceHeight,n,i),this.fillArea(t.renderer,5,this.width-this.sliceWidth,this.sliceHeight,this.sliceWidth,i),this.fillArea(t.renderer,6,0,this.height-this.sliceHeight),this.fillArea(t.renderer,7,this.sliceWidth,this.height-this.sliceHeight,n,this.sliceHeight),this.fillArea(t.renderer,8,this.width-this.sliceWidth,this.height-this.sliceHeight),t.renderer.translate(Math.round(e.x),Math.round(e.y)))},s}),bento.define("bento/components/sprite",["bento","bento/utils","bento/math/vector2"],function(t,e,n){"use strict";var i=function(t){return this instanceof i?(this.entity=null,this.name="sprite",this.visible=!0,this.parent=null,this.rootIndex=-1,this.animationSettings=t||{frameCountX:1,frameCountY:1},this.spriteImage=null,this.frameCountX=1,this.frameCountY=1,this.frameWidth=0,this.frameHeight=0,this.padding=0,this.origin=new n(0,0),this.currentSpriteSheet="",this.frameIndex=0,this.sourceFrame=0,this.sourceX=0,this.sourceY=0,this.animations={},this.currentAnimation=null,this.currentAnimationLength=0,this.onCompleteCallback=function(){},void this.setup(t)):new i(t)};return i.prototype.setup=function(n){var i,o=this,r=0;if(n&&n.spriteSheet&&(i=t.assets.getSpriteSheet(n.spriteSheet),this.currentSpriteSheet=n.spriteSheet,n=e.copyObject(i.animation),n.image=i.image,n.animation&&(n.animations={"default":n.animation})),this.animationSettings=n||this.animationSettings,r=this.animationSettings.padding||0,this.animations["default"]||(this.animationSettings.animations||(this.animationSettings.animations={}),this.animationSettings.animations["default"]||(this.animationSettings.animations["default"]={frames:[0]})),n.image)this.spriteImage=n.image;else if(n.imageName){if(!t.assets)throw"Bento asset manager not loaded";this.spriteImage=t.assets.getImage(n.imageName)}else{if(!n.imageFromUrl)return;if(!this.spriteImage&&t.assets)return void t.assets.loadImageFromUrl(n.imageFromUrl,n.imageFromUrl,function(e,i){o.spriteImage=t.assets.getImage(n.imageFromUrl),o.setup(n),n.onLoad&&n.onLoad()})}return this.spriteImage?(this.animationSettings.frameWidth?(this.frameWidth=this.animationSettings.frameWidth,this.frameCountX=Math.floor(this.spriteImage.width/this.frameWidth)):(this.frameCountX=this.animationSettings.frameCountX||1,this.frameWidth=(this.spriteImage.width-r*(this.frameCountX-1))/this.frameCountX),this.animationSettings.frameHeight?(this.frameHeight=this.animationSettings.frameHeight,this.frameCountY=Math.floor(this.spriteImage.height/this.frameHeight)):(this.frameCountY=this.animationSettings.frameCountY||1,this.frameHeight=(this.spriteImage.height-r*(this.frameCountY-1))/this.frameCountY),this.padding=this.animationSettings.padding||0,this.animationSettings.origin?(this.origin.x=this.animationSettings.origin.x,this.origin.y=this.animationSettings.origin.y):this.animationSettings.originRelative&&this.setOriginRelative(this.animationSettings.originRelative),e.extend(this.animations,this.animationSettings.animations,!0),this.setAnimation("default"),void this.updateEntity()):void e.log("ERROR: something went wrong with loading the sprite.")},i.prototype.updateEntity=function(){if(this.entity){var t=this.entity.origin.x/this.entity.dimension.width,e=this.entity.origin.y/this.entity.dimension.height;this.entity.dimension.width=this.frameWidth,this.entity.dimension.height=this.frameHeight,this.entity.setOriginRelative(new n(t,e))}},i.prototype.attached=function(t){var e,n=this.animationSettings.animations,o=0,r=0,a=0;this.entity=t.entity,this.updateEntity();for(e in n){for(o=0,r=n[e].frames.length;r>o;++o)n[e].frames[o]>a&&(a=n[e].frames[o]);!i.suppressWarnings&&a>this.frameCountX*this.frameCountY-1&&console.log("Warning: the frames in animation "+e+" of "+(this.entity.name||this.entity.settings.name)+" are out of bounds. Can't use frame "+a+".")}},i.prototype.setAnimation=function(t,n,o){var r=this.animations[t];return i.suppressWarnings||r?void(r&&(this.currentAnimation!==r||null!==this.onCompleteCallback&&e.isDefined(n))&&(e.isDefined(r.loop)||(r.loop=!0),e.isDefined(r.backTo)||(r.backTo=0),this.onCompleteCallback=n,this.currentAnimation=r,this.currentAnimation.name=t,this.currentAnimationLength=this.currentAnimation.frames.length,o||(this.currentFrame=0),!i.suppressWarnings&&this.currentAnimation.backTo>this.currentAnimationLength&&(console.log("Warning: animation "+t+" has a faulty backTo parameter"),this.currentAnimation.backTo=this.currentAnimationLength))):void console.log("Warning: animation "+t+" does not exist.")},i.prototype.setSpriteSheet=function(t,e){this.currentSpriteSheet!==t&&(this.setup({spriteSheet:t}),this.onCompleteCallback=e)},i.prototype.getAnimationName=function(){return this.currentAnimation.name},i.prototype.setFrame=function(t){this.currentFrame=t},i.prototype.getCurrentSpeed=function(){return this.currentAnimation.speed},i.prototype.setCurrentSpeed=function(t){this.currentAnimation.speed=t},i.prototype.getCurrentFrame=function(){return this.currentFrame},i.prototype.getFrameWidth=function(){return this.frameWidth},i.prototype.setOriginRelative=function(t){this.origin.x=t.x*this.frameWidth,this.origin.y=t.y*this.frameHeight},i.prototype.update=function(t){var e;if(this.currentAnimation&&!(this.currentAnimationLength<=1||0===this.currentAnimation.speed)){var n=this.currentAnimation.speed||1;if(this.currentAnimation.frameSpeeds&&this.currentAnimation.frameSpeeds.length-1>=this.currentFrame&&(n*=this.currentAnimation.frameSpeeds[Math.floor(this.currentFrame)]),e=!1,this.currentFrame+=n*t.speed,this.currentAnimation.loop)for(;this.currentFrame>=this.currentAnimation.frames.length;)this.currentFrame-=this.currentAnimation.frames.length-this.currentAnimation.backTo,e=!0;else this.currentFrame>=this.currentAnimation.frames.length&&(e=!0);e&&this.onCompleteCallback&&(this.onCompleteCallback(),this.currentAnimation.loop||(this.onCompleteCallback=null))}},i.prototype.updateFrame=function(){this.frameIndex=Math.min(Math.floor(this.currentFrame),this.currentAnimation.frames.length-1),this.sourceFrame=this.currentAnimation.frames[this.frameIndex],this.sourceX=this.sourceFrame%this.frameCountX*(this.frameWidth+this.padding),this.sourceY=Math.floor(this.sourceFrame/this.frameCountX)*(this.frameHeight+this.padding)},i.prototype.draw=function(t){var e=t.entity,n=e.origin;this.currentAnimation&&this.visible&&(this.updateFrame(),t.renderer.drawImage(this.spriteImage,this.sourceX,this.sourceY,this.frameWidth,this.frameHeight,-n.x-this.origin.x|0,-n.y-this.origin.y|0,this.frameWidth,this.frameHeight))},i.prototype.toString=function(){return"[object Sprite]"},i.suppressWarnings=!1,i}),bento.define("bento/lib/domready",[],function(){"use strict";function t(t){var e;for(e=0;e<t.length;e+=1)t[e](c)}function e(){var e=h;u&&e.length&&(h=[],t(e))}function n(){u||(u=!0,a&&clearInterval(a),e())}function i(t){return u?t(c):h.push(t),i}var o,r,a,s="undefined"!=typeof window&&window.document,u=!s,c=s?document:null,h=[];if(s){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),r=document.createElement("div");try{o=null===window.frameElement}catch(d){}r.doScroll&&o&&window.external&&(a=setInterval(function(){try{r.doScroll(),n()}catch(t){}},30))}"complete"===document.readyState&&n()}return i.version="2.0.1",i.load=function(t,e,n,o){o.isBuild?n(null):i(n)},i}),bento.define("lzstring",[],function(){function t(t,e){if(!o[t]){o[t]={};for(var n=0;n<t.length;n++)o[t][t.charAt(n)]=n}return o[t][e]}var e=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={},r={compressToBase64:function(t){if(null==t)return"";var e=r._compress(t,6,function(t){return n.charAt(t)});switch(e.length%4){default:case 0:return e;case 1:return e+"===";case 2:return e+"==";case 3:return e+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:r._decompress(e.length,32,function(i){return t(n,e.charAt(i))})},compressToUTF16:function(t){return null==t?"":r._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(t){return null==t?"":""==t?null:r._decompress(t.length,16384,function(e){return t.charCodeAt(e)-32})},compressToUint8Array:function(t){for(var e=r.compress(t),n=new Uint8Array(2*e.length),i=0,o=e.length;o>i;i++){var a=e.charCodeAt(i);n[2*i]=a>>>8,n[2*i+1]=a%256}return n},decompressFromUint8Array:function(t){if(null===t||void 0===t)return r.decompress(t);for(var n=new Array(t.length/2),i=0,o=n.length;o>i;i++)n[i]=256*t[2*i]+t[2*i+1];var a=[];return n.forEach(function(t){a.push(e(t))}),r.decompress(a.join(""))},compressToEncodedURIComponent:function(t){return null==t?"":r._compress(t,6,function(t){return i.charAt(t)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),r._decompress(e.length,32,function(n){return t(i,e.charAt(n))}))},compress:function(t){return r._compress(t,16,function(t){return e(t)})},_compress:function(t,e,n){if(null==t)return"";var i,o,r,a={},s={},u="",c="",h="",d=2,l=3,f=2,p=[],g=0,m=0;for(r=0;r<t.length;r+=1)if(u=t.charAt(r),Object.prototype.hasOwnProperty.call(a,u)||(a[u]=l++,s[u]=!0),c=h+u,Object.prototype.hasOwnProperty.call(a,c))h=c;else{if(Object.prototype.hasOwnProperty.call(s,h)){if(h.charCodeAt(0)<256){for(i=0;f>i;i++)g<<=1,m==e-1?(m=0,p.push(n(g)),g=0):m++;for(o=h.charCodeAt(0),i=0;8>i;i++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1}else{for(o=1,i=0;f>i;i++)g=g<<1|o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o=0;for(o=h.charCodeAt(0),i=0;16>i;i++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1}d--,0==d&&(d=Math.pow(2,f),f++),delete s[h]}else for(o=a[h],i=0;f>i;i++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1;d--,0==d&&(d=Math.pow(2,f),f++),a[c]=l++,h=String(u)}if(""!==h){if(Object.prototype.hasOwnProperty.call(s,h)){if(h.charCodeAt(0)<256){for(i=0;f>i;i++)g<<=1,m==e-1?(m=0,p.push(n(g)),g=0):m++;for(o=h.charCodeAt(0),i=0;8>i;i++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1}else{for(o=1,i=0;f>i;i++)g=g<<1|o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o=0;for(o=h.charCodeAt(0),i=0;16>i;i++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1}d--,0==d&&(d=Math.pow(2,f),f++),delete s[h]}else for(o=a[h],i=0;f>i;i++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1;d--,0==d&&(d=Math.pow(2,f),f++)}for(o=2,i=0;f>i;i++)g=g<<1|1&o,m==e-1?(m=0,p.push(n(g)),g=0):m++,o>>=1;for(;;){if(g<<=1,m==e-1){p.push(n(g));break}m++}return p.join("")},decompress:function(t){return null==t?"":""==t?null:r._decompress(t.length,32768,function(e){return t.charCodeAt(e)})},_decompress:function(t,n,i){var o,r,a,s,u,c,h,d,l=[],f=4,p=4,g=3,m="",v=[],y={val:i(0),position:n,index:1};for(r=0;3>r;r+=1)l[r]=r;for(s=0,c=Math.pow(2,2),h=1;h!=c;)u=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),s|=(u>0?1:0)*h,h<<=1;switch(o=s){case 0:for(s=0,c=Math.pow(2,8),h=1;h!=c;)u=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),s|=(u>0?1:0)*h,h<<=1;d=e(s);break;case 1:for(s=0,c=Math.pow(2,16),h=1;h!=c;)u=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),s|=(u>0?1:0)*h,h<<=1;d=e(s);break;case 2:return""}for(l[3]=d,a=d,v.push(d);;){if(y.index>t)return"";for(s=0,c=Math.pow(2,g),h=1;h!=c;)u=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),s|=(u>0?1:0)*h,h<<=1;switch(d=s){case 0:for(s=0,c=Math.pow(2,8),h=1;h!=c;)u=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),s|=(u>0?1:0)*h,h<<=1;l[p++]=e(s),d=p-1,f--;break;case 1:for(s=0,c=Math.pow(2,16),h=1;h!=c;)u=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=i(y.index++)),s|=(u>0?1:0)*h,h<<=1;l[p++]=e(s),d=p-1,f--;break;case 2:return v.join("")}if(0==f&&(f=Math.pow(2,g),g++),l[d])m=l[d];else{if(d!==p)return null;m=a+a.charAt(0)}v.push(m),l[p++]=a+m.charAt(0),f--,a=m,0==f&&(f=Math.pow(2,g),g++)}}};return r}),bento.define("bento/lib/requestanimationframe",[],function(){"use strict";for(var t=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];return window.requestAnimationFrame||(window.requestAnimationFrame=function(e,n){var i=(new Date).getTime(),o=Math.max(0,16-(i-t)),r=window.setTimeout(function(){e(i+o)},o);return t=i+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),window.requestAnimationFrame}),bento.define("bento/managers/asset",["bento/packedimage","bento/utils","audia"],function(t,e,n){"use strict";return function(){var i={},o="",r={audio:{},json:{},images:{},binary:{},fonts:{},spritesheets:{},texturePacker:{}},a=[],s=function(t,i,r){var a,s=!0,u=function(e,o){var a=new n,u=a.canPlayType("audio/"+i[e].slice(-3));return u||window.ejecta?(a.onload=function(){r(null,t,a)},a.src=o,s=!1,!0):!1};for(e.isArray(i)||(i=[i]),a=0;a<i.length&&!u(a,o+"audio/"+i[a]);++a);s&&r("This audio type is not supported:",t,i)},u=function(t,n,i){var o=new window.XMLHttpRequest;o.overrideMimeType&&o.overrideMimeType("application/json"),o.open("GET",n,!0),o.onerror=function(){i("Error: loading JSON "+n)},o.ontimeout=function(){i("Timeout: loading JSON "+n)},o.onreadystatechange=function(){var r;if(4===o.readyState)if(304===o.status||200===o.status||0===o.status&&o.responseText){try{r=JSON.parse(o.responseText)}catch(a){e.log("ERROR: Could not parse JSON "+t+" at "+n),console.log("Trying to parse",o.responseText)}i(null,t,r)}else i("Error: State "+o.readyState+" "+n)},o.send(null)},c=function(t,n,i){var o=new Image;o.src=n,o.addEventListener("load",function(){i(null,t,o)},!1),o.addEventListener("error",function(t){e.log("ERROR: loading image "+n)},!1)},h=function(t,e,n){var i,o,r=t,a=document.createElement("canvas"),s=a.getContext("2d"),u=0,c=0,h=function(){return u=s.measureText("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890.,").width},d=function(){var n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML="@font-face { font-family: '"+t+"'; src: url('"+e+"');}",document.body.appendChild(n),s.font="normal 16px "+t},l=function(){return i!==h()};t.indexOf("/")>=0&&(r=t.split("/"),t=r[r.length-1]),d(),i=h(),o=window.setInterval(function(){l()?(window.clearInterval(o),n&&n(null,t,t)):c>=10&&(window.clearInterval(o),console.log('Warning: font "'+t+'" timed out with loading.'),n&&n(null,t,t)),c+=1},100)},d=function(e,n,i){var o={image:null,animation:null},r=function(){null!==o.image&&null!==o.animation&&i(null,e,o)};u(e,n+".json",function(t,e,n){return t?void i(t,e,null):(o.animation=n,void r())}),c(e,n+".png",function(e,n,a){return e?void i(e,n,null):(o.image=t(a),void r())})},l=function(t,n,o){var r,a=e.getKeyLength(t),s=0,c=function(t,r,u){return t?void e.log(t):(i[r]=u,s+=1,e.isDefined(o)&&o(s,a,r),void(a===s&&e.isDefined(n)&&n(null)))};for(r in t)t.hasOwnProperty(r)&&u(r,t[r],c)},f=function(t,n,l){var f,p=i[t],g=0,m=0,v=[],y=function(){g===m&&e.isDefined(n)&&(k(),n(null))},w=function(t,n,i){return t?void e.log(t):(r.images[n]=i,g+=1,e.isDefined(l)&&l(g,m,n),void y())},b=function(t,n,i){return t?void e.log(t):(r.json[n]=i,a.push(n),g+=1,e.isDefined(l)&&l(g,m,n),void y())},x=function(t,n,i){return t?void e.log(t):(r.json[n]=i,g+=1,e.isDefined(l)&&l(g,m,n),void y())},E=function(t,n,i){return t?void e.log(t):(r.fonts[n]=i,g+=1,e.isDefined(l)&&l(g,m,n),void y())},S=function(t,n,i){t?e.log(t):r.audio[n]=i,g+=1,e.isDefined(l)&&l(g,m,n),y()},P=function(t,n,i){t?e.log(t):r.spritesheets[n]=i,g+=1,e.isDefined(l)&&l(g,m,n),y()},O=function(t,e,n,i){v.push({fn:t,asset:e,path:n,callback:i})},A=function(){var t,e=0;for(e=0;e<v.length;++e)t=v[e],t.fn(t.asset,t.path,t.callback)};if(!e.isDefined(p))return void n("Could not find asset group "+t);if(e.isDefined(p.path)&&(o=p.path),e.isDefined(p.images)){m+=e.getKeyLength(p.images);for(f in p.images)p.images.hasOwnProperty(f)&&O(c,f,o+"images/"+p.images[f],w)}if(e.isDefined(p.texturePacker)){m+=e.getKeyLength(p.texturePacker);for(f in p.texturePacker)p.texturePacker.hasOwnProperty(f)&&O(u,f,o+"json/"+p.texturePacker[f],b)}if(e.isDefined(p.audio)){m+=e.getKeyLength(p.audio);for(f in p.audio)p.audio.hasOwnProperty(f)&&O(s,f,p.audio[f],S)}if(e.isDefined(p.json)){m+=e.getKeyLength(p.json);for(f in p.json)p.json.hasOwnProperty(f)&&O(u,f,o+"json/"+p.json[f],x)}if(e.isDefined(p.fonts)){m+=e.getKeyLength(p.fonts);for(f in p.fonts)p.fonts.hasOwnProperty(f)&&O(h,f,o+"fonts/"+p.fonts[f],E)}if(e.isDefined(p.spritesheets)){m+=e.getKeyLength(p.spritesheets);for(f in p.spritesheets)p.spritesheets.hasOwnProperty(f)&&O(d,f,o+"spritesheets/"+p.spritesheets[f],P)}return A(),m},p=function(t,n,i){var o=function(t,n,o){return t?(e.log(t),void(i&&i(t))):(r.images[n]=o,void(i&&i(null,o)))};c(t,n,o)},g=function(t,n,i){var o=function(t,n,o){return t?(e.log(t),void(i&&i(t))):(r.json[n]=o,void(i&&i(null,o)))};u(t,n,o)},m=function(t,n,i){var o=function(t,n,o){return t?(e.log(t),void(i&&i(t))):(r.audio[n]=o,void(i&&i(o)))};s(t,n,o)},v=function(t,n){var o=i[t];return o?void e.forEach(o,function(t,i){"object"==typeof t&&e.forEach(t,function(t,e){var o=r[i]||{},a=o[e];a&&(o[e]=void 0,delete o[e],"images"===i&&r.texturePacker[e]&&(r.texturePacker[e]=void 0,delete r.texturePacker[e]),n&&(a.dispose?a.dispose():a.image&&a.image.dispose?a.image.dispose():a._audioNode&&a._audioNode.dispose&&a._audioNode.dispose()))})}):void e.log("ERROR: asset group "+t+" does not exist")},y=function(n){var i,o=r.texturePacker[n];if(!o){if(i=w(n),!i)return e.log("ERROR: Image "+n+" could not be found"),null;o=t(i),r.texturePacker[n]=o}return o},w=function(t){var n=r.images[t];return e.isDefined(n)||e.log("ERROR: ImageElement "+t+" could not be found"),n},b=function(t){var n=r.json[t];return e.isDefined(n)||e.log("ERROR: JSON "+t+" could not be found"),n},x=function(t){var n=r.audio[t];return e.isDefined(n)||e.log("ERROR: Audio "+t+" could not be found"),n},E=function(t){var n=r.spritesheets[t];return e.isDefined(n)||e.log("ERROR: Sprite sheet "+t+" could not be found"),n},S=function(){return r},k=function(){for(var e,n,i,o,s,u;a.length;){if(n=a.pop(),o=w(n,!0),s=b(n,!0),!o||!s)return void a.push(n);for(i=0;i<s.frames.length;++i)u=s.frames[i].filename,u=u.substring(0,u.length-4),e=s.frames[i].frame,r.texturePacker[u]=new t(o,e)}},P=function(){return i},O=function(t){var e,n=0,o=0,r=function(){o+=1,o===n&&t&&t()};for(e in i)i.hasOwnProperty(e)&&(f(e,r,function(t,e){}),n+=1)},A=function(t){u("assets.json","assets.json",function(n,o,r){var a=!1,s={};return n?void t(n):(e.forEach(r,function(t,n,o,r){e.isString(t)?(a=!0,s[n]=t):i[n]=t}),void(a?l(s,t):t(null)))})},C=function(t){var e,n,o=t.exceptions||[],r=t.onReady||t.onComplete||function(){},a=t.onLoaded||t.onLoad||function(){},s=0,u=0,c=0,h=0,d=function(){c+=1,c===s&&r&&r()},l=function(t,e,n){h+=1,a&&a(h,u,n)};for(n in i)i.hasOwnProperty(n)&&(o.indexOf(n)>=0||(e=i[n],u+=f(n,d,l),s+=1));0===s&&r&&r()};return{reload:O,loadAllAssets:C,loadAssetGroups:l,loadAssetsJson:A,load:f,loadJson:u,loadImageFromUrl:p,loadJsonFromUrl:g,loadAudioFromUrl:m,unload:v,getImage:y,getImageElement:w,getJson:b,getAudio:x,getSpriteSheet:E,getAssets:S,getAssetGroups:P}}}),bento.define("bento/managers/audio",["bento/utils"],function(t){return function(e){var n,i,o=!1,r=!1,a=!1,s=!1,u=!1,c="",h=0,d=e.assets,l=(e.getCanvas(),function(t){t?(n=o,i=r,f.muteMusic(!0),f.muteSound(!0)):(o=n,r=i,c&&f.playMusic(c,u))}),f={setVolume:function(t,e){var n=d.getAudio(e);n&&(n.volume=t)},getVolume:function(e){var n=d.getAudio(e);return n?n.volume:(t.log("ERROR: Could not find audio file"),0)},playSound:function(e,n,i,r){var s=d.getAudio(e),u=e.lastIndexOf("/");return s?("sfx_"!==e.substr(u+1,4)&&t.log("Warning: file names of sound effects should start with 'sfx_'"),void(o||a||(r&&f.stopSound(e),t.isDefined(n)&&(s.loop=n),t.isDefined(i)&&(s.onended=i),s.play()))):void t.log("ERROR: Could not find audio file")},stopSound:function(e){var n=d.getAudio(e);return n?void n.stop():void t.log("ERROR: Could not find audio file")},playMusic:function(e,n,i,o){var a,h=e.lastIndexOf("/");if(o&&f.stopAllMusic(),"bgm_"!==e.substr(h+1,4)&&t.log("Warning: file names of music tracks should start with 'bgm_'"),c=e,u=t.isDefined(n)?n:!0,!r&&""!==c){if(a=d.getAudio(e),!a)return void t.log("ERROR: Could not find audio file");i&&(a.onended=i),a.loop=u,a.play(),s=!0}},stopMusic:function(t){d.getAudio(t).stop(),s=!1},muteSound:function(t){o=t,o&&this.stopAllSound()},muteMusic:function(e,n){var i=c;r=e,t.isDefined(n)||(n=!1),r?(f.stopAllMusic(),c=i):n&&""!==c&&f.playMusic(c,u)},stopAllSound:function(){var t,e=d.getAssets().audio;for(t in e)e.hasOwnProperty(t)&&t.indexOf("sfx_")>=0&&e[t].stop()},stopAllMusic:function(){var t,e=d.getAssets().audio;for(t in e)e.hasOwnProperty(t)&&t.indexOf("bgm_")>=0&&e[t].stop(t===c?h:void 0);c="",s=!1},preventSounds:function(t){a=t},isPlayingMusic:function(t){return t?c===t:s}};return"hidden"in document?document.addEventListener("visibilitychange",function(){l(document.hidden)},!1):"mozHidden"in document?document.addEventListener("mozvisibilitychange",function(){l(document.mozHidden)},!1):"webkitHidden"in document?document.addEventListener("webkitvisibilitychange",function(){l(document.webkitHidden)},!1):"msHidden"in document?document.addEventListener("msvisibilitychange",function(){l(document.msHidden)},!1):"onpagehide"in window?(window.addEventListener("pagehide",function(){l(!0)},!1),window.addEventListener("pageshow",function(){l(!1)},!1)):"onblur"in document?(window.addEventListener("blur",function(){l(!0)},!1),window.addEventListener("focus",function(){l(!1)},!1)):"onfocusout"in document&&(window.addEventListener("focusout",function(){l(!0)},!1),window.addEventListener("focusin",function(){l(!1)},!1)),f}}),bento.define("bento/managers/input",["bento/utils","bento/math/vector2","bento/eventsystem"],function(t,e,n){"use strict";var i={};return function(o,r){var a,s,u,c,h,d,l=!1,f=[],p={},g=0,m=0,v=[],y={},w=[],b={},x=function(t){f.push({id:t.id,position:t.position,eventType:t.eventType,localPosition:t.localPosition,worldPosition:t.worldPosition}),n.fire("pointerDown",t)},E=function(t){n.fire("pointerMove",t),D(t)},S=function(t){n.fire("pointerUp",t),T(t)},k=function(t){var e;for(t.preventDefault(),e=0;e<t.changedTouches.length;++e)I(t,e,"start"),x(t)},P=function(t){var e;for(t.preventDefault(),e=0;e<t.changedTouches.length;++e)I(t,e,"move"),E(t)},O=function(t){var e;for(t.preventDefault(),e=0;e<t.changedTouches.length;++e)I(t,e,"end"),S(t)},A=function(t){R(t,"start"),x(t)},C=function(t){R(t,"move"),E(t)},M=function(t){R(t,"end"),S(t)},I=function(n,o,r){var a=n.changedTouches[o],c=(a.pageX-g)/s.x,h=(a.pageY-m)/s.y,d={};n.preventDefault(),n.id=0,n.eventType="touch",a.position=new e(c,h),a.worldPosition=a.position.clone(),a.worldPosition.x+=u.x,a.worldPosition.y+=u.y,a.localPosition=a.position.clone(),n.position=a.position.clone(),n.worldPosition=a.worldPosition.clone(),n.localPosition=a.localPosition.clone(),n.id=a.identifier+1,"start"===r&&(d.startPosition=a.position.clone(),d.startWorldPosition=a.worldPosition.clone(),d.startLocalPosition=a.localPosition.clone(),i[n.id]=d),"end"===r&&(d=i[n.id],d&&d.startPosition?(a.diffPosition=a.position.substract(d.startPosition),a.diffWorldPosition=a.worldPosition.substract(d.startWorldPosition),a.diffLocalPosition=a.localPosition.substract(d.startLocalPosition),n.diffPosition=a.diffPosition.clone(),n.diffWorldPosition=a.diffWorldPosition.clone(),n.diffLocalPosition=a.diffLocalPosition.clone(),delete i[n.id]):t.log("ERROR: touch startPosition was not defined"))},R=function(t,n){var o=(t.pageX-g)/s.x,r=(t.pageY-m)/s.y,a={},c=-1;t.id=0,t.eventType="mouse",t.position=new e(o,r),t.worldPosition=t.position.clone(),t.worldPosition.x+=u.x,t.worldPosition.y+=u.y,t.localPosition=t.position.clone(),"start"===n&&(a.startPosition=t.position.clone(),a.startWorldPosition=t.worldPosition.clone(),a.startLocalPosition=t.localPosition.clone(),i[c]=a),"end"===n&&(a=i[c],t.diffPosition=t.position.substract(a.startPosition),t.diffWorldPosition=t.worldPosition.substract(a.startWorldPosition),t.diffLocalPosition=t.localPosition.substract(a.startLocalPosition)),t.id=-1},D=function(t){var e=0;for(e=0;e<f.length;++e)if(f[e].id===t.id)return f[e].position=t.position,f[e].worldPosition=t.worldPosition,void(f[e].localPosition=t.position)},T=function(t){var e=0;for(e=0;e<f.length;++e)if(f[e].id===t.id)return void f.splice(e,1)},L=function(){window.ejecta&&(a.addEventListener("tvtouchstart",$),a.addEventListener("tvtouchmove",tt),a.addEventListener("tvtouchend",et)),a.addEventListener("touchstart",k),a.addEventListener("touchmove",P),a.addEventListener("touchend",O),r.globalMouseUp?window.addEventListener("mouseup",M):a.addEventListener("mouseup",M),a.addEventListener("mousedown",A),a.addEventListener("mousemove",C),l=!0,a.addEventListener("touchstart",function(t){return t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),!1}),a.addEventListener("touchmove",function(t){return t&&t.preventDefault&&t.preventDefault(),t&&t.stopPropagation&&t.stopPropagation(),!1})},j=function(){var t=o.canvas||window,e=function(e){t.focus&&t.focus()};t.tabIndex=0,t.focus&&t.focus(),t.addEventListener("keydown",N,!1),t.addEventListener("keyup",W,!1),t.addEventListener("mousedown",e,!1)},N=function(e){var i,o;if(e.preventDefault(),n.fire("keyDown",e),o=t.keyboardMapping[e.keyCode],!o)return void t.log("ERROR: Key with keyCode "+e.keyCode+" is undefined.");for(i=0;i<o.length;++i)p[o[i]]=!0,n.fire("buttonDown",o[i]),n.fire("buttonDown-"+o[i])},W=function(e){var i,o;if(e.preventDefault(),n.fire("keyUp",e),o=t.keyboardMapping[e.keyCode],!o)return void t.log("ERROR: Key with keyCode "+e.keyCode+" is undefined.");for(i=0;i<o.length;++i)p[o[i]]=!1,n.fire("buttonUp",o[i])},_=function(){t.isCocoonJs()?(s.x=window.innerWidth/u.width,s.y=window.innerHeight/u.height):(s.x=a.offsetWidth/u.width,s.y=a.offsetHeight/u.height,g=a.offsetLeft,m=a.offsetTop)},B=function(){a&&a.addEventListener&&(a.addEventListener("contextmenu",function(t){n.fire("mouseDown-right"),r.preventContextMenu&&t.preventDefault()},!1),a.addEventListener("click",function(t){1===t.which?(n.fire("mouseDown-left"),t.preventDefault()):2===t.which&&(n.fire("mouseDown-middle"),t.preventDefault())},!1))},U=function(){window.addEventListener("gamepadconnected",q),window.addEventListener("gamepaddisconnected",H)},q=function(t){n.on("preUpdate",F),console.log("Gamepad connected:",t.gamepad)},H=function(t){c=void 0,n.off("preUpdate",F)},F=function(){var t=0,e=0;for(h=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads():[],t=0,e=h.length;e>t;++t)h[t]&&(c=h[t]);if(c)for(t=0,e=c.buttons.length;e>t;++t)c.buttons[t].pressed!==v[t]&&(c.buttons[t].pressed?z(t):G(t))},z=function(e){var i=0,o=t.gamepadMapping[e],r=0;for(n.fire("gamepadKeyDown",e),v[e]=!0,i=0,r=o.length;r>i;++i)y[o[i]]=!0,n.fire("gamepadButtonDown",o[i]),n.fire("gamepadButtonDown-"+o[i])},G=function(e){var i=0,o=t.gamepadMapping[e],r=0;for(n.fire("gamepadKeyUp",e),v[e]=!1,i=0,r=o.length;r>i;++i)y[o[i]]=!1,n.fire("gamepadButtonUp",o[i])},X=function(){var t,e=0;if(window.ejecta){for(t=navigator.getGamepads(),e=0;e<t.length;++e)t[e]&&"microGamepad"===t[e].profile&&(d=t[e]);for(e=0;e<d.buttons.length;++e)w.push(d.buttons[e].pressed);n.on("preUpdate",Y)}},Y=function(){var t=0,e=0;for(t=0,e=d.buttons.length;e>t;++t)d.buttons[t].pressed!==w[t]&&(d.buttons[t].pressed?Q(t):J(t))},Q=function(e){var n=0,i=t.remoteMapping[e];for(w[e]=!0,n=0;n<i.length;++n)b[i[n]]=!0},J=function(e){var n=0,i=t.remoteMapping[e];for(w[e]=!1,n=0;n<i.length;++n)b[i[n]]=!1},V=function(t){f.push({id:t.id,position:t.position,eventType:t.eventType,localPosition:t.localPosition,worldPosition:t.worldPosition}),n.fire("tvPointerDown",t)},K=function(t){n.fire("tvPointerMove",t),D(t)},Z=function(t){n.fire("tvPointerUp",t),T(t)},$=function(t){var e;for(t.preventDefault(),e=0;e<t.changedTouches.length;++e)nt(t,e,"start"),V(t)},tt=function(t){var e;for(t.preventDefault(),e=0;e<t.changedTouches.length;++e)nt(t,e,"move"),K(t)},et=function(t){var e;for(t.preventDefault(),e=0;e<t.changedTouches.length;++e)nt(t,e,"end"),Z(t)},nt=function(n,o,r){var a=n.changedTouches[o],c=(a.pageX-g)/s.x,h=(a.pageY-m)/s.y,d={};n.preventDefault(),n.id=0,n.eventType="tvtouch",a.position=new e(c,h),a.worldPosition=a.position.clone(),a.worldPosition.x+=u.x,a.worldPosition.y+=u.y,a.localPosition=a.position.clone(),n.position=a.position.clone(),n.worldPosition=a.worldPosition.clone(),n.localPosition=a.localPosition.clone(),n.id=a.identifier+1,"start"===r&&(d.startPosition=a.position.clone(),d.startWorldPosition=a.worldPosition.clone(),d.startLocalPosition=a.localPosition.clone(),i[n.id]=d),"end"===r&&(d=i[n.id],d&&d.startPosition?(a.diffPosition=a.position.substract(d.startPosition),a.diffWorldPosition=a.worldPosition.substract(d.startWorldPosition),a.diffLocalPosition=a.localPosition.substract(d.startLocalPosition),n.diffPosition=a.diffPosition.clone(),n.diffWorldPosition=a.diffWorldPosition.clone(),n.diffLocalPosition=a.diffLocalPosition.clone(),delete i[n.id]):t.log("ERROR: touch startPosition was not defined"))};if(!o)throw"Supply a gameData object";return s=o.canvasScale,a=o.canvas,u=o.viewport,a&&(window.addEventListener("resize",_,!1),window.addEventListener("orientationchange",_,!1),_()),L(),j(),B(),X(),U(),{getPointers:function(){return f},resetPointers:function(){f.length=0},isKeyDown:function(t){return p[t]||!1},isAnyKeyDown:function(){var t;for(t in p)if(p[t])return!0;return!1},isGamepadConnected:function(){return c?!0:!1},isGamepadButtonDown:function(t){return y[t]||!1},isAnyGamepadButtonDown:function(){var t;for(t in y)if(y[t])return!0;return!1},getGamepadAxesLeft:function(){return new e(c.axes[0],c.axes[1])},getGamepadAxesRight:function(){return new e(c.axes[2],c.axes[3])},isRemoteButtonDown:function(t){return b[t]||!1},setRemoteExitOnMenuPress:function(t){d.exitOnMenuPress=t},getRemoteAxes:function(){return new e(d.axes[0],d.axes[1])},stop:function(){l&&(window.ejecta&&(a.removeEventListener("tvtouchstart",$),a.removeEventListener("tvtouchmove",tt),a.removeEventListener("tvtouchend",et)),a.removeEventListener("touchstart",k),a.removeEventListener("touchmove",P),a.removeEventListener("touchend",O),a.removeEventListener("mousedown",A),a.removeEventListener("mousemove",C),r.globalMouseUp?window.removeEventListener("mouseup",M):a.removeEventListener("mouseup",M),l=!1)},resume:function(){l||(window.ejecta&&(a.addEventListener("tvtouchstart",$),a.addEventListener("tvtouchmove",tt),
a.addEventListener("tvtouchend",et)),a.addEventListener("touchstart",k),a.addEventListener("touchmove",P),a.addEventListener("touchend",O),a.addEventListener("mousedown",A),a.addEventListener("mousemove",C),r.globalMouseUp?window.addEventListener("mouseup",M):a.addEventListener("mouseup",M),l=!0)},updateCanvas:_}}}),bento.define("bento/managers/object",["bento/utils","bento/eventsystem"],function(t,e){"use strict";return function(n,i){var o,r=[],a=(new Date).getTime(),s=0,u=30,c=(new Date).getTime(),h={},d=!1,l=i.sortMode||0,f=0,p=function(){r.sort(function(t,e){return t.z-e.z})},g=function(){t.stableSort.inplace(r,function(t,e){return t.z-e.z})},m=g,v=function(){var t;for(t=r.length-1;t>=0;--t)null===r[t]&&r.splice(t,1)},y=function(e){var r=(new Date).getTime(),h=r-a,f=n();if(d){for(i.debug&&o&&o.tickStart(),a=r,s+=h,f=n(),f.deltaT=h,i.useDeltaT&&(s=1e3/60);s>=1e3/60;){if(s-=1e3/60,s>1e3/u)for(;s>=1e3/60;)s-=1e3/60;i.useDeltaT&&(s=0),w(f)}v(),l===t.SortMode.ALWAYS&&m(),b(f),c=e,i.debug&&o&&o.tick(),window.requestAnimationFrame(y)}},w=function(t){var i,o;for(t=t||n(),e.fire("preUpdate",t),o=0;o<r.length;++o)i=r[o],i&&(i.update&&i.updateWhenPaused>=f&&i.update(t),void 0!==i.rootIndex&&(i.rootIndex=o));e.fire("postUpdate",t)},b=function(t){var i,o;for(t=t||n(),e.fire("preDraw",t),t.renderer.begin(),o=0;o<r.length;++o)i=r[o],i&&i.draw&&i.draw(t);t.renderer.flush(),e.fire("postDraw",t)},x=function(e){var i,o,a,s=n();if(!e)return void t.log("ERROR: trying to attach "+e);if(e.isAdded||e.parent)return void t.log("ERROR: Entity "+e.name+" was already added.");if(e.z=e.z||0,e.updateWhenPaused=e.updateWhenPaused||0,r.push(e),e.isAdded=!0,e.init&&e.init(),e.family)for(a=e.family,i=0;i<a.length;++i)o=a[i],h[o]||(h[o]=[]),h[o].push(e);e.start&&e.start(s),e.attached&&e.attached(s),l===t.SortMode.SORT_ON_ADD&&m()},E={attach:x,add:x,remove:function(e){var i,o,a,s,u,c=n();if(e&&(a=r.indexOf(e),a>=0&&(r[a]=null,e.destroy&&e.destroy(c),e.removed&&e.removed(c),e.isAdded=!1),e.family))for(s=e.family,i=0;i<s.length;++i)o=s[i],u=h[o],u&&t.removeFromArray(h[o],e)},removeAll:function(t){var e,n;for(e=0;e<r.length;++e)n=r[e],n&&(!n.global||t)&&E.remove(n);for(v(),e=0;e<r.length;++e)n=r[e]},get:function(t,e){var n,i;for(n=0;n<r.length;++n)if(i=r[n],i&&i.name&&i.name===t)return e&&e(i),i;return null},getByName:function(t,e){var n,i,o=[];for(n=0;n<r.length;++n)i=r[n],i&&i.name&&i.name===t&&o.push(i);return e&&o.length&&e(o),o},getByFamily:function(t,e){var n=h[t];return n||(n=[],h[t]=n),e&&n.length&&e(n),n},stop:function(){d=!1},run:function(){d||(d=!0,y())},count:function(){return r.length},pause:function(e){f=e,t.isUndefined(e)&&(f=1)},resume:function(){f=0},isPaused:function(e){return t.isDefined(e)?e.updateWhenPaused<f:f},draw:function(t){b(t)},setSortMode:function(t){l=t},update:function(t){w(t)},getObjects:function(){return r}};return window.performance||(window.performance={now:Date.now}),i.debug&&t.isDefined(window.FPSMeter)&&(window.FPSMeter.defaults.graph=1,o=new window.FPSMeter),i.defaultSort&&(m=p),E}}),bento.define("bento/managers/savestate",["bento/utils"],function(t){"use strict";var e,n=document.URL,i={data:{},setItem:function(t,e){var n,i=0,o=this.data;o[t]=e;for(n in o)o.hasOwnProperty(n)&&++i;this.length=i},getItem:function(e){var n=i.data[e];return t.isDefined(n)?n:null},removeItem:function(t){delete i.data[t]},clear:function(){this.data={},this.length=0},length:0};try{if(e=window.localStorage,!window.localStorage)throw"No local storage available";window.localStorage.setItem(n+"save","0")}catch(o){console.log("Warning: you have disabled cookies on your browser. You cannot save progress in your game."),e=i}return{saveKeys:!1,save:function(i,o){var r;if(!i)return void t.log("ERROR: savestate key is not defined.");if("string"!=typeof i&&(i=JSON.stringify(i)),void 0===o&&(t.log("ERROR: Don't save a value as undefined, it can't be loaded back in. Use null instead."),o=null),e.setItem(n+i,JSON.stringify(o)),this.saveKeys){if(r=this.load("_keys",[]),r.indexOf(i)>-1)return;r.push(i),e.setItem(n+"_keys",JSON.stringify(r))}},add:function(e,n){if(!e)return void t.log("ERROR: savestate key is not defined.");var i=this.load(e,0);i+=n,this.save(e,i)},load:function(i,o){var r;if(!i)return void t.log("ERROR: savestate key is not defined.");if(r=e.getItem(n+i),null===r||void 0===r)return o;try{return JSON.parse(r)}catch(a){return t.log("ERROR: save file corrupted. "+a),o}},remove:function(i){return i?void e.removeItem(n+i):void t.log("ERROR: savestate key is not defined.")},clear:function(){e.clear()},debug:function(){console.log(localStorage)},isEmpty:function(){return 0===e.length},getId:function(){return n.slice(0)},setId:function(t){n=t},setStorage:function(t){e=t},getStorage:function(){return e}}}),bento.define("bento/managers/screen",["bento/eventsystem","bento/utils"],function(t,e){"use strict";return function(){var e={},n=null,i={add:function(t){if(!t.name)throw"Add name property to screen";e[t.name]=t},show:function(o,r,a){null!==n&&i.hide({next:o}),n=e[o],n?(n.onShow&&n.onShow(r),t.fire("screenShown",n),a&&a()):bento.require([o],function(t){t.name||(t.name=o),i.add(t),i.show(o,r,a)})},hide:function(e){n&&(n.onHide&&n.onHide(e),t.fire("screenHidden",n),n=null)},getCurrentScreen:function(){return n},reset:function(){e={}}};return i}}),bento.define("bento/math/array2d",[],function(){"use strict";return function(t,e){var n,i,o=[];for(n=0;t>n;++n)for(o[n]=[],i=0;e>i;++i)o[n][i]=null;return{isArray2d:function(){return!0},iterate:function(n){var i,r;for(r=0;e>r;++r)for(i=0;t>i;++i)n(i,r,o[i][r])},get:function(t,e){return o[t][e]},set:function(t,e,n){o[t][e]=n}}}}),bento.define("bento/math/matrix",["bento/utils"],function(t){"use strict";var e=function(t){var e=this.clone();return e.addTo(t),e},n=function(t,e){var n=this.clone();return n.multiplyWith(other),n},i=function(o,r){var a,s,u=[],c=o||0,h=r||0,d=function(t,e,n){u[e*c+t]=n},l=function(t,e){return u[e*c+t]};for(s=0;h>s;++s)for(a=0;c>a;++a)a===s?d(a,s,1):d(a,s,0);return{isMatrix:function(){return!0},stringify:function(){var t,e,n="",i="";for(e=0;h>e;++e){for(t=0;c>t;++t)i+=l(t,e)+"	";n+=i+"\n",i=""}return n},get:function(t,e){return l(t,e)},set:function(t,e,n){d(t,e,n)},setValues:function(t){var e,n=Math.min(u.length,t.length);for(e=0;n>e;++e)u[e]=t[e];return this},getWidth:function(){return c},getHeight:function(){return h},iterate:function(e){var n,i;for(i=0;h>i;++i)for(n=0;c>n;++n){if(!t.isFunction(e))throw"Please supply a callback function";e(n,i,l(n,i))}},transpose:function(){var t,e,n=[];for(t=0;c>t;++t)for(e=0;h>e;++e)n[t*h+e]=l(t,e);return u=n,h=[c,c=h][0],this},addTo:function(t){var e,n;if(h!=t.getHeight()||c!=t.getWidth())throw"Matrix sizes incorrect";for(n=0;h>n;++n)for(e=0;c>e;++e)d(e,n,l(e,n)+t.get(e,n));return this},add:e,multiplyWith:function(t){var e,n,i,o=[],r=c,a=h,s=t.getHeight(),d=t.getWidth(),f=0;if(a!=d)throw"Matrix sizes incorrect";for(n=0;s>n;++n)for(e=0;r>e;++e){for(f=0,i=0;d>i;++i)f+=t.get(i,n)*l(e,i);o[n*r+e]=f}return u=o,c=r,h=s,this},multiply:n,clone:function(){var t=i(c,h);return t.setValues(u),t}}};return i}),bento.define("bento/math/polygon",["bento/utils","bento/math/rectangle"],function(t,e){"use strict";var n=function(){return!0},i=function(){for(var t=[],e=this.points,n=e.length;n--;)t[n]=e[n];return u(t)},o=function(t){for(var e=[],n=this.points,i=n.length;i--;)e[i]=n[i],e[i].x+=t.x,e[i].y+=t.y;return u(e)},r=function(t,e,n,i){var o,r,a=function(t,e){return t.x*e.y-t.y*e.x},s=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},u=s(e,t),c=s(i,n),h=a(s(n,t),u),d=a(u,c);return 0===h&&0===d?n.x-t.x<0!=n.x-e.x<0!=i.x-t.x<0!=i.x-e.x<0||n.y-t.y<0!=n.y-e.y<0!=i.y-t.y<0!=i.y-e.y<0:0===d?!1:(o=h/d,r=a(s(n,t),c)/d,r>=0&&1>=r&&o>=0&&1>=o)},a=function(t){var e,n,i,o,a,s,c=[],h=this.points;if(t.isRectangle){if(!this.getBoundingBox().intersect(t))return!1;c.push({x:t.x,y:t.y}),c.push({x:t.getX2(),y:t.y}),c.push({x:t.getX2(),y:t.getY2()}),c.push({x:t.x,y:t.getY2()}),t=u(c)}else{if(!this.getBoundingBox().intersect(t.getBoundingBox()))return!1;c=t.points}for(a=0;a<h.length;++a)for(s=0;s<c.length;++s)if(e=h[a],n=h[(a+1)%h.length],i=c[s],o=c[(s+1)%c.length],r(e,n,i,o))return!0;return this.hasPosition(c[0])||t.hasPosition(h[0])?!0:!1},s=function(t){var e=this.points,n=!1,i=0,o=e.length-1,r=this.getBoundingBox();if(t.x<r.x||t.x>r.x+r.width||t.y<r.y||t.y>r.y+r.height)return!1;for(o;i<e.length;o=i++)e[i].y>t.y!=e[o].y>t.y&&t.x<(e[o].x-e[i].x)*(t.y-e[i].y)/(e[o].y-e[i].y)+e[i].x&&(n=!n);return n},u=function(t){var r,u=t[0].x,c=t[0].x,h=t[0].y,d=t[0].y,l=1;for(l=1;l<t.length;++l)r=t[l],u=Math.min(r.x,u),c=Math.max(r.x,c),h=Math.min(r.y,h),d=Math.max(r.y,d);return{x:u,y:h,width:c-u,height:d-h,points:t,isPolygon:n,getBoundingBox:function(){return new e(u,h,c-u,d-h)},hasPosition:s,intersect:a,offset:o,clone:i}};return u}),bento.define("bento/math/rectangle",["bento/utils","bento/math/vector2"],function(t,e){"use strict";var n=function(t,e,i,o){return this instanceof n?(this.x=t,this.y=e,this.width=i,void(this.height=o)):new n(t,e,i,o)};return n.prototype.isRectangle=function(){return!0},n.prototype.getX2=function(){return this.x+this.width},n.prototype.getY2=function(){return this.y+this.height},n.prototype.union=function(t){var e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),o=Math.max(this.getX2(),t.getX2()),r=Math.max(this.getY2(),t.getY2());return new n(e,i,o-e,r-i)},n.prototype.intersect=function(t){return t.isPolygon?t.intersect(this):!(this.x+this.width<=t.x||this.y+this.height<=t.y||this.x>=t.x+t.width||this.y>=t.y+t.height)},n.prototype.intersection=function(t){var e=new n(0,0,0,0);return this.intersect(t)&&(e.x=Math.max(this.x,t.x),e.y=Math.max(this.y,t.y),e.width=Math.min(this.x+this.width,t.x+t.width)-e.x,e.height=Math.min(this.y+this.height,t.y+t.height)-e.y),e},n.prototype.intersectsCircle=function(t,n){var i=.5*this.width,o=.5*this.height,r=new e(this.x+i,this.y+o),a=Math.abs(t.x-r.x),s=Math.abs(t.y-r.y),u=0;return a>i+n||s>o+n?!1:i>=a||o>=s?!0:(u=(a-i)*(a-i)+(s-o)*(s-o),n*n>=u)},n.prototype.intersectsLine=function(t,e){var n=function(t,e,n,i,o,r,a,s){var u=n-t,c=i-e,h=a-o,d=s-r,l=(-c*(t-o)+u*(e-r))/(-h*c+u*d),f=(h*(e-r)-d*(t-o))/(-h*c+u*d);return l>=0&&1>=l&&f>=0&&1>=f},i=this.x,o=this.y,r=this.getX2(),a=this.getY2();return this.hasPosition(t)&&this.hasPosition(e)||n(t.x,t.y,e.x,e.y,i,o,i,a)||n(t.x,t.y,e.x,e.y,i,o,r,o)||n(t.x,t.y,e.x,e.y,r,o,r,a)||n(t.x,t.y,e.x,e.y,i,a,r,a)},n.prototype.offset=function(t){return new n(this.x+t.x,this.y+t.y,this.width,this.height)},n.prototype.clone=function(){return new n(this.x,this.y,this.width,this.height)},n.prototype.hasPosition=function(t){return!(t.x<this.x||t.y<this.y||t.x>=this.x+this.width||t.y>=this.y+this.height)},n.prototype.grow=function(t,e,n){return e||(this.x-=t/2,this.width+=t),n||(this.y-=t/2,this.height+=t),this},n.prototype.getCorner=function(t){return t?1===t?new e(this.x+this.width,this.y):2===t?new e(this.x,this.y+this.height):3===t?new e(this.x+this.width,this.y+this.height):new e(this.x+this.width/2,this.y+this.height/2):new e(this.x,this.y)},n.prototype.getCenter=function(){return new e(this.x+this.width/2,this.y+this.height/2)},n.prototype.getSize=function(){return new n(0,0,this.width,this.height)},n.prototype.getExtents=function(){return new e(this.width/2,this.height/2)},n.prototype.toString=function(){return"[object Rectangle]"},n}),bento.define("bento/math/transformmatrix",["bento/utils","bento/math/vector2"],function(t,e){"use strict";var n=function(){return this instanceof n?(this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,void(this.ty=0)):new n};return n.prototype.multiplyWithVector=function(t){var e=t.x,n=t.y;return t.x=this.a*e+this.c*n+this.tx,t.y=this.b*e+this.d*n+this.ty,t},n.prototype.inverseMultiplyWithVector=function(t){var e=t.x,n=t.y,i=1/(this.a*this.d-this.c*this.b);return t.x=this.d*e*i+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*i,t.y=this.a*n*i+-this.b*e*i+(-this.ty*this.a+this.tx*this.b)*i,t},n.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},n.prototype.scale=function(t,e){return this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.tx*=t,this.ty*=e,this},n.prototype.rotate=function(t,e,n){var i=this.a,o=this.b,r=this.c,a=this.d,s=this.tx,u=this.ty;return void 0===e&&(e=Math.sin(t)),void 0===n&&(n=Math.cos(t)),this.a=i*n-o*e,this.b=i*e+o*n,this.c=r*n-a*e,this.d=r*e+a*n,this.tx=s*n-u*e,this.ty=s*e+u*n,this},n.prototype.multiplyWith=function(t){var e=this.a,n=this.b,i=this.c,o=this.d;return this.a=t.a*e+t.b*i,this.b=t.a*n+t.b*o,this.c=t.c*e+t.d*i,this.d=t.c*n+t.d*o,this.tx=t.tx*e+t.ty*i+this.tx,this.ty=t.tx*n+t.ty*o+this.ty,this},n.prototype.multiply=function(t){return this.clone().multiplyWith(t)},n.prototype.clone=function(){var t=new n;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},n.prototype.reset=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},n.prototype.identity=n.prototype.reset,n.prototype.prependWith=function(t){var e=this.tx,n=this.a,i=this.c;return this.a=n*t.a+this.b*t.c,this.b=n*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d,this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},n.prototype.prepend=function(t){return this.clone().prependWith(t)},n.prototype.appendWith=n.prototype.multiplyWith,n.prototype.append=n.prototype.multiply,n.prototype.toString=function(){return"[object Matrix]"},n}),bento.define("bento/math/vector2",["bento/math/matrix"],function(t){"use strict";var e=function(t,n){return this instanceof e?(this.x=t||0,void(this.y=n||0)):new e(t,n)};return e.prototype.isVector2=function(){return!0},e.prototype.add=function(t){var e=this.clone();return e.addTo(t),e},e.prototype.addTo=function(t){return this.x+=t.x,this.y+=t.y,this},e.prototype.subtract=function(t){var e=this.clone();return e.substractFrom(t),e},e.prototype.subtractFrom=function(t){return this.x-=t.x,this.y-=t.y,this},e.prototype.substract=e.prototype.subtract,e.prototype.substractFrom=e.prototype.subtractFrom,e.prototype.angle=function(){return Math.atan2(this.y,this.x)},e.prototype.angleBetween=function(t){return Math.atan2(t.y-this.y,t.x-this.x)},e.prototype.dotProduct=function(t){return this.x*t.x+this.y*t.y},e.prototype.multiply=function(t){var e=this.clone();return e.multiplyWith(t),e},e.prototype.multiplyWith=function(t){return this.x*=t.x,this.y*=t.y,this},e.prototype.divide=function(t){var e=this.clone();return e.divideBy(t),e},e.prototype.divideBy=function(t){return this.x/=t.x,this.y/=t.y,this},e.prototype.scalarMultiply=function(t){var e=this.clone();return e.scalarMultiplyWith(t),e},e.prototype.scalarMultiplyWith=function(t){return this.x*=t,this.y*=t,this},e.prototype.scale=e.prototype.scalarMultiplyWith,e.prototype.magnitude=function(){return Math.sqrt(this.sqrMagnitude())},e.prototype.sqrMagnitude=function(){return this.dotProduct(this)},e.prototype.normalize=function(){var t=this.magnitude();return this.x/=t,this.y/=t,this},e.prototype.distance=function(t){return t.substract(this).magnitude()},e.prototype.isFartherThan=function(t,e){var n=t.substract(this);return n.x*n.x+n.y*n.y>e*e},e.prototype.isCloserThan=function(t,e){var n=t.substract(this);return n.x*n.x+n.y*n.y<e*e},e.prototype.rotateRadian=function(t){var e=this.x*Math.cos(t)-this.y*Math.sin(t),n=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=e,this.y=n,this},e.prototype.rotateDegree=function(t){return this.rotateRadian(t*Math.PI/180)},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.toMatrix=function(){var e=new t(1,3);return e.set(0,0,this.x),e.set(0,1,this.y),e.set(0,2,1),e},e.prototype.reflect=function(t){var e=t.normalize(),n=this.dotProduct(e);return this.substractFrom(e.scalarMultiplyWith(n+n))},e.prototype.toString=function(){return"[object Vector2]"},e}),bento.define("bento/autoresize",["bento/utils"],function(t){return function(t,e,n,i){var o=(t.clone(),window.innerWidth),r=window.innerHeight,a=window.devicePixelRatio,s=i?o*a:r*a,u=i?r*a:o*a,c=function(){var e=t.width;t.width=t.height,t.height=e},h=function(){var h=u/s;return h>1&&(h=1/h),t.height=t.width/h,t.height<e&&(t.height=e,t.width=h*t.height),t.height>n&&(t.height=n,t.width=h*t.height),i&&c(),console.log("Screen size: "+o*a+" x "+r*a),console.log("Resolution: "+t.width.toFixed(2)+" x "+t.height.toFixed(2)),t},d=function(){window.scrollTo(0,0)};return window.addEventListener("orientationchange",d,!1),i&&c(),h()}}),bento.define("bento/canvas",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/eventsystem","bento/utils","bento/tween","bento/packedimage","bento/objectpool","bento/renderers/canvas2d"],function(t,e,n,i,o,r,a,s,u,c,h,d){"use strict";var l=new h({poolSize:1,constructor:function(){var t=document.createElement("canvas");return t},destructor:function(t){var e=t.getContext("2d");return e.clearRect(0,0,t.width,t.height),t.texture&&(t.texture=null),t}});return function(e){var n,o,a,s,u,h,f,p,g,m,v=(t.getViewport(),!1),y={name:"rendererSwapper",draw:function(t){v||(e.preventAutoClear||u.clearRect(0,0,s.width,s.height),s.texture&&(s.texture=null),h=t.renderer,t.renderer=f,t.renderer.save(),t.renderer.translate(Math.round(g.origin.x),Math.round(g.origin.y)))},postDraw:function(t){v||(t.renderer.restore(),t.renderer=h,e.drawOnce&&(v=!0))}};if(e.canvas?s=e.canvas:(s=l.get(),s.width=e.width,s.height=e.height),u=s.getContext("2d"),f=new d(s,{pixelSize:e.pixelSize||1}),p=new c(s),a=new i({image:p}),m=[a,y],e.components)for(n=0,o=e.components.length;o>n;++n)m.push(e.components[n]);return g=new r({z:e.z,name:e.name,origin:e.origin,originRelative:e.originRelative,position:e.position,components:m,family:e.family,init:e.init}),g.extend({getCanvas:function(){return s},getContext:function(){return u}}),g}}),bento.define("bento/color",["bento/utils"],function(t){return function(e,n,i,o){return e/=255,e=n/255,e=i/255,t.isDefined(o)||(o=1),[e,n,i,o]}}),bento.define("bento/objectpool",["bento","bento/utils"],function(t,e){"use strict";return function(t){var n=[],i=!1,o=t.constructor,r=t.destructor,a=function(){n.push(o())};if(!o)throw"Error: Must pass a settings.constructor function that returns an object";if(!r)throw"Error: Must pass a settings.destructor function that cleans the object";return{get:function(){return 0===n.length&&a(),n.pop()},discard:function(t){r(t),n.push(t)},init:function(){i||(i=!0,e.repeat(t.poolSize||0,a))}}}}),bento.define("bento/screen",["bento/utils","bento","bento/math/rectangle","bento/math/vector2","bento/tiled"],function(t,e,n,i,o){"use strict";var r=function(n){var i=e.getViewport(),r={name:null,tiled:null,dimension:n&&n.dimension?n.dimension:i.clone(),extend:function(e){return t.extend(this,e)},loadTiled:function(t){this.tiled=new o({assetName:t,spawnBackground:!0,spawnEntities:!0}),this.dimension=this.tiled.dimension},onShow:function(t){n&&(n.tiled&&this.loadTiled(n.tiled),n.onShow&&n.onShow.call(r,t))},onHide:function(t){var i=e.getViewport();e.removeAll(),i.x=0,i.y=0,n.onHide&&n.onHide.call(r,t)}};return r};return r}),bento.define("bento/sortedeventsystem",["bento","bento/eventsystem","bento/utils"],function(t,e,n){var i=function(e){var n,i=-1,o=-1,a=-1,s=e.parent,u=-1,c=[],h=null;if(null===r&&(r=t.objects.getObjects()),s)for(o=e.rootIndex,s.parent&&(u=s.rootIndex);s;)c.unshift(s),a+=1,s.parent||(h=s),s=s.parent;else h=e;i=h.rootIndex,n=h.z,this.isDirty=!1,this.component=e,this.parent=s,this.parentIndex=u,this.parents=c,this.componentIndex=o,this.depth=a,this.rootParent=h,this.rootIndex=i,this.rootZ=n},o=!1,r=null,a={},s=[],u=function(){var t,e,i,r,u,c;if(!o){for(e=0;e<s.length;++e)if(r=s[e].eventName,s[e].reset!==!0){if(u=s[e].callback,c=s[e].context,!n.isUndefined(a[r]))for(i=a[r],t=i.length-1;t>=0;--t)if(i[t].callback===u){if(!c){a[r].splice(t,1);break}if(i[t].context===c){a[r].splice(t,1);break}}}else a[r]=[];s=[]}},c=function(t,e,o,r){var s=new i(t);return n.isString(t)?void n.log("ERROR: First parameter of SortedEventSystem.on is the component!"):(n.isUndefined(a[e])&&(a[e]=[]),void a[e].push({sortingData:s,callback:o,context:r}))},h=function(t,e,n){var i=a[t];i&&0!==i.length&&(s.push({eventName:t,callback:e,context:n}),o||u())},d=function(t){var e=a[t];e&&0!==e.length&&(s.push({eventName:t,reset:!0}),o||u())},l=function(t,e){var n=t.sortingData,o=e.sortingData;if(n.isDirty&&(t.sortingData=new i(n.component),n=t.sortingData),o.isDirty&&(e.sortingData=new i(o.component),o=e.sortingData),n.component===o.component)return 0;var r=o.rootZ-n.rootZ;if(r)return r;var a=o.rootIndex-n.rootIndex;if(a)return a;var s=n.component.parent,u=o.component.parent;return s===u?o.componentIndex-n.componentIndex:s&&u&&s.parent===u.parent?o.parentIndex-n.parentIndex:n.parents.indexOf(o.component.parent)>=0||o.parents.indexOf(n.component.parent)>=0?o.depth-n.depth:f(n,o)},f=function(t,e){var n,i,o,r=t.parents,a=e.parents,s=Math.min(r.length,a.length),u=null;for(n=0;s>n;++n){if(r[n]!==a[n]){i=r[n],o=a[n];break}u=r[n]}return u&&u.components?u.components.indexOf(o)-u.components.indexOf(i):0},p=function(t){var e,n=0,i=t.length;for(n=0;i>n;++n)e=t[n].sortingData,e.rootZ!==e.rootParent.z&&(e.isDirty=!0),e.rootIndex=e.rootParent.rootIndex},g=function(t){n.stableSort.inplace(t,l)},m=!1,v={suppressWarnings:!1,stopPropagation:function(){m=!0},fire:function(t,e){var i,r,s,c;if(m=!1,u(),n.isString(t)||(t=t.toString()),!n.isUndefined(a[t])){for(s=a[t],p(s),g(s),i=0,r=s.length;r>i;++i)if(o=!0,c=s[i],c?c.context?c.callback.apply(c.context,[e]):c.callback(e):!this.suppressWarnings,m){m=!1;break}o=!1}},addEventListener:c,removeEventListener:h,on:c,off:h,clear:d,sortListeners:g};return e.SortedEventSystem=v,v}),bento.define("bento/tiled",["bento","bento/entity","bento/components/sprite","bento/math/vector2","bento/math/rectangle","bento/math/polygon","bento/packedimage","bento/utils","bento/tiledreader"],function(t,e,n,i,o,r,a,s,u){"use strict";var c=function(t,e){var n=Math.ceil(e.x/t.x),o=Math.ceil(e.y/t.y),r=(n*t.x,o*t.y,{length:0}),a=function(e){var i,a,s,u=[];for(i=0;n*o>i;++i)a=document.createElement("canvas"),a.width=t.x,a.height=t.y,s=a.getContext("2d"),a.context=s,u.push(a);r[e]=u,r.length=Math.max(r.length,e+1)},s=function(e,i){var s=Math.floor(i.x/t.x)%n,u=Math.floor(i.y/t.y)%o,c=s+u*n;return r[e]||a(e),{index:c,canvas:r[e][c]}};return{spritesCountX:n,spritesCountY:o,canvasSize:t,layers:r,getSpritesFromLayer:function(t){return r[t]},drawTile:function(e,o,r,a,u,c,h,d){var l=s(e,o),f=l.canvas,p=l.index,g=f.context,m=!1,v=!1,y=0,w=new i(t.x*(p%n),t.y*Math.floor(p/n));h?u||c?u&&!c?y=Math.PI/2:!u&&c?y=3*Math.PI/2:u&&c&&(y=Math.PI/2,m=!0):(y=Math.PI/2,v=!0):u&&c?y=Math.PI:(m=u,v=c),g.save(),g.translate(o.x-w.x,o.y-w.y),g.translate(r.width/2,r.height/2),g.rotate(y),g.scale(m?-1:1,v?-1:1),g.translate(-r.width/2,-r.height/2),void 0!==d&&(g.globalAlpha=d),g.drawImage(a.image,a.x+r.x,a.y+r.y,r.width,r.height,0,0,o.width,o.height),g.globalAlpha=1,g.restore()}}},h=function(r){var h=r.assetName,d=r.tiled||t.assets.getJson(h),l=d.width||0,f=d.height||0,p=d.tilewidth||0,g=d.tileheight||0,m=r.merge||!1,v=r.onInit,y=r.onLayer,w=r.onTile,b=r.onObject,x=r.onComplete,E=r.onSpawn,S=r.onSpawnComplete,k=s.getDefault(r.attachEntities,!0),P=r.offset||new i(0,0),O=r.maxCanvasSize||new i(1024,1024),A=new i(l*p,f*g),C=-1,M=new c(O,A),I=[],R=[],D=0,T=0,L=1,j=new u({tiled:d,onInit:v,onExternalTileset:function(e){var n,i,o=e.indexOf("json/"),r=e.indexOf("../"),a=e;if(o>=0)a=e.substring(o+"json/".length);else if(r>=0)if(a=e,h){for(i=h.split("/"),i.pop();a.indexOf("../")>=0;){if(0===i.length)throw"ERROR: Impossible path to external tileset";i.pop(),a=a.replace("../","")}a=i.join("/")+(i.length?"/":"")+a}else for(;a.indexOf("../")>=0;)a=a.replace("../","");return a=a.replace(".json",""),n=t.assets.getJson(a)},onLayer:function(t){"tilelayer"===t.type&&(m?C=0:C+=1),L=t.opacity,y&&y.call(_,t)},onTile:function(e,n,i,r,a,s,u){var c,h,d=e*p,l=n*g,f=new o(d,l,p,g),m=N(i,r),v=i.image;c=v.substring(v.indexOf("images/")+"images/".length),c=c.replace(".png",""),h=t.assets.getImage(c),M.drawTile(C,f,m,h,a,s,u,L),w&&w.call(_,e,n,i,r,a,s,u)},onObject:function(t,e,n){b&&b.call(_,t,e,n),r.spawnEntities&&W(t,e,n)},onComplete:function(){var o,s,u=M.layers,c=u.length,h=M.canvasSize,l=M.spritesCountX,f=(M.spritesCountY,function(){var u,c,f,p=0,g=d.layers[s];for(p=0;p<o.length;++p)u=o[p],c=new n({image:new a(u)}),f=new e({z:0,name:g.name||"background",family:["backgrounds"],position:new i(P.x+h.x*(p%l),P.y+h.y*Math.floor(p/l)),components:[c]}),r.spawnBackground&&t.objects.attach(f),R.push(f)});for(s=0;c>s;++s)o=u[s],o&&f();x&&x.call(_),r.spawnEntities&&0===T&&S&&S.call(_)}}),N=function(t,e){var n=Math.floor(t.imagewidth/t.tilewidth);Math.floor(t.imageheight/t.tileheight);return new o(e%n*t.tilewidth,Math.floor(e/n)*t.tileheight,t.tilewidth,t.tileheight)},W=function(e,n,o){var r,a,s,u,c=e.x,d=e.y;e.gid&&(r=n.tileproperties,r&&(a=r[o],a&&(s=a.module,s&&(u={tiled:{position:new i(c,d),tileSet:n,tileIndex:o,tileProperties:a,object:e,objectProperties:e.properties,jsonName:h}},T+=1,bento.require([s],function(n){var o=new n(u),r=o.origin,a=o.dimension,s=r.clone();o.getComponent("sprite",function(t){s.addTo(t.origin)}),o.position=new i(P.x+c+s.x,P.y+d+(s.y-a.height)),k&&t.objects.attach(o),I.push(o),D+=1,E&&E.call(_,o,e),D===T&&S&&S.call(_)})))))},_={name:r.name||"tiled",assetName:h,dimension:new o(0,0,A.x,A.y),entities:I,backgrounds:R,layerImages:M};return j.read(),_};return h}),bento.define("bento/tiledreader",[],function(){"use strict";var t=2147483648,e=1073741824,n=536870912,i=function(i){var o=i.onExternalTileset,r=i.onInit,a=i.onLayer,s=i.onTile,u=i.onObject,c=i.onComplete,h=i.tiled||{},d=h.width||0,l=h.height||0,f=(h.tilewidth||0,h.tileheight||0,h.tilesets||[]),p=f.length,g={},m=[],v=h.layers||[],y=(v.length,function(){var t,e,n,i;for(t=0,e=f.length;e>t;++t)n=f[t],i=n.source,i&&(g[i]=o(i)),m.push(n.firstgid)}),w=function(t){var e=function(t){var e,n=window.atob(t),i=n.length,o=new Uint8Array(i);for(e=0;i>e;e++)o[e]=n.charCodeAt(e);var r=new Uint32Array(o.buffer,0,i/4);return r},n=t.encoding;if("base64"===n)t.data=e(t.data),t.encoding=null;else if(n)throw"ERROR: compression not supported. Please set Tile Layer Format to CSV in Tiled.";return t},b=function(){var i,o,r,v,y,b,x,E,S,k,P=h.layers,O=function(t){var e,n,i,o=p,r=null;for(e=0;o>e;++e)n=m[e],t>=n&&(r=f[e],i=n);return r.source&&(r=g[r.source]),{tileSet:r,firstGid:i}},A=function(i,o,r){var a,u,c,h,l,f=i[r*d+o];0!==f&&(c=f&t,h=f&e,l=f&n,f&=~(t|e|n),a=O(f),u=f-a.firstGid,s(o,r,a.tileSet,u,c,h,l))},C=function(t){var e,n,i=t.gid;i?(n=O(i),e=i-n.firstGid,u(t,n.tileSet,e)):u(t)};for(v=0,y=P.length;y>v;++v)if(b=P[v],k=b.type,a&&a(b),"tilelayer"===k){if(!b.visible)continue;for(w(b),x=b.data,r=0;l>r;++r)for(i=0;d>i;++i)A(x,i,r)}else if("objectgroup"===k)for(E=b.objects||[],o=E.length,i=0;o>i;++i)S=E[i],C(S);c&&c()};return y(),r&&r(h,g),{read:b}};return i}),bento.define("bento/tween",["bento","bento/math/vector2","bento/utils","bento/entity"],function(t,e,n,i){"use strict";var o={easeInQuad:function(t,e,n,i){return n*(t/=i)*t+e},easeOutQuad:function(t,e,n,i){return-n*(t/=i)*(t-2)+e},easeInOutQuad:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,n,i){return n*(t/=i)*t*t+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},easeInOutCubic:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,n,i){return n*(t/=i)*t*t*t+e},easeOutQuart:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,n,i){return n*(t/=i)*t*t*t*t+e},easeOutQuint:function(t,e,n,i){return n*((t=t/i-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+e},easeOutSine:function(t,e,n,i){return n*Math.sin(t/i*(Math.PI/2))+e},easeInOutSine:function(t,e,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+e},easeInExpo:function(t,e,n,i){return 0===t?e:n*Math.pow(2,10*(t/i-1))+e},easeOutExpo:function(t,e,n,i){return t===i?e+n:n*(-Math.pow(2,-10*t/i)+1)+e},easeInOutExpo:function(t,e,n,i){return 0===t?e:t===i?e+n:(t/=i/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(-Math.pow(2,-10*--t)+2)+e},easeInCirc:function(t,e,n,i){return-n*(Math.sqrt(1-(t/=i)*t)-1)+e},easeOutCirc:function(t,e,n,i){return n*Math.sqrt(1-(t=t/i-1)*t)+e},easeInOutCirc:function(t,e,n,i){return(t/=i/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,n,i){var o=1.70158,r=0,a=n;return 0===t?e:1===(t/=i)?e+n:(r||(r=.3*i),a<Math.abs(n)?(a=n,o=r/4):o=r/(2*Math.PI)*Math.asin(n/a),-(a*Math.pow(2,10*(t-=1))*Math.sin((t*i-o)*(2*Math.PI)/r))+e)},easeOutElastic:function(t,e,n,i){var o=1.70158,r=0,a=n;return 0===t?e:1===(t/=i)?e+n:(r||(r=.3*i),a<Math.abs(n)?(a=n,o=r/4):o=r/(2*Math.PI)*Math.asin(n/a),a*Math.pow(2,-10*t)*Math.sin((t*i-o)*(2*Math.PI)/r)+n+e)},easeInOutElastic:function(t,e,n,i){var o=1.70158,r=0,a=n;return 0===t?e:2===(t/=i/2)?e+n:(r||(r=i*(.3*1.5)),a<Math.abs(n)?(a=n,o=r/4):o=r/(2*Math.PI)*Math.asin(n/a),1>t?-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*i-o)*(2*Math.PI)/r))+e:a*Math.pow(2,-10*(t-=1))*Math.sin((t*i-o)*(2*Math.PI)/r)*.5+n+e)},easeInBack:function(t,e,n,i,o){return void 0===o&&(o=1.70158),n*(t/=i)*t*((o+1)*t-o)+e},easeOutBack:function(t,e,n,i,o){return void 0===o&&(o=1.70158),n*((t=t/i-1)*t*((o+1)*t+o)+1)+e},easeInOutBack:function(t,e,n,i,o){return void 0===o&&(o=1.70158),(t/=i/2)<1?n/2*(t*t*(((o*=1.525)+1)*t-o))+e:n/2*((t-=2)*t*(((o*=1.525)+1)*t+o)+2)+e},easeInBounce:function(t,e,n,i){return n-this.easeOutBounce(i-t,0,n,i)+e},easeOutBounce:function(t,e,n,i){return(t/=i)<1/2.75?n*(7.5625*t*t)+e:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},easeInOutBounce:function(t,e,n,i){return i/2>t?.5*this.easeInBounce(2*t,0,n,i)+e:.5*this.easeOutBounce(2*t-i,0,n,i)+.5*n+e}},r={linear:function(t,e,n,i,o){return(e-t)*n+t},quadratic:function(t,e,n,i,o){return(e-t)*n*n+t},squareroot:function(t,e,n,i,o){return(e-t)*Math.pow(n,.5)+t},cubic:function(t,e,n,i,o){return(e-t)*n*n*n+t},cuberoot:function(t,e,n,i,o){return(e-t)*Math.pow(n,1/3)+t},exponential:function(t,e,n,i,o){return(e-t)/(Math.exp(i)-1)*Math.exp(i*n)+t-(e-t)/(Math.exp(i)-1)},elastic:function(t,e,n,i,o){return(e-t)/(Math.exp(i)-1)*Math.cos(o*n*2*Math.PI)*Math.exp(i*n)+t-(e-t)/(Math.exp(i)-1)},sin:function(t,e,n,i,o){return t+e*Math.sin(i*n*2*Math.PI)},cos:function(t,e,n,i,o){return t+e*Math.cos(i*n*2*Math.PI)}},a=function(t,n,i,a,s,u){var c=r[t];return n.isVector2&&i.isVector2?c?new e(c(n.x,i.x,a,s,u),c(n.y,i.y,a,s,u)):new e(o[t](a,n.x,i.x-n.x,1),o[t](a,n.y,i.y-n.y,1)):c?c(n,i,a,s,u):o[t](a,n,i-n,1)},s=function(e){var o=0,r=!1,s=!0,u=e.onUpdate||e["do"],c=e.onComplete,h=e.onStart,d=!1,l=e.ease||"linear",f=e.from||0,p=e.delay||0,g=0,m=n.isDefined(e.to)?e.to:1,v=e["in"]||1,y=n.isDefined(e.alpha)?e.alpha:1,w=n.isDefined(e.beta)?e.beta:1,b=e.ignoreGameSpeed,x=e.stay,E=-1,S=new i(e).extend({id:e.id,update:function(e){if(0===--E&&S.resume(),s){if(p>g)return void(g+=b?1:e.speed);o+=b?1:e.speed,d||(d=!0,h&&h.apply(this)),u&&u.apply(this,[a(l,f,m,o/v,y,w),o]),o>=v&&!x&&(o>v&&u&&u.apply(this,[a(l,f,m,1,y,w),o]),c&&c.apply(this),t.objects.remove(S),r=!1)}},begin:function(){return o=0,r||(t.objects.add(S),r=!0),s=!0,S},stop:function(){return o=0,s=!1,S},pause:function(t){return s=!1,t&&(E=t),S},resume:function(){return r?(s=!0,S):S.begin()}});return n.isDefined(e.ease)||n.log("WARNING: settings.ease is undefined."),n.isDefined(e.updateWhenPaused)||(S.updateWhenPaused=t.objects.isPaused()),S.begin(),S};return s.LINEAR="linear",s.QUADRATIC="quadratic",s.CUBIC="cubic",s.SQUAREROOT="squareroot",s.CUBEROOT="cuberoot",s.EXPONENTIAL="exponential",s.ELASTIC="elastic",s.SIN="sin",s.COS="cos",s.EASEINQUAD="easeInQuad",s.EASEOUTQUAD="easeOutQuad",s.EASEINOUTQUAD="easeInOutQuad",
s.EASEINCUBIC="easeInCubic",s.EASEOUTCUBIC="easeOutCubic",s.EASEINOUTCUBIC="easeInOutCubic",s.EASEINQUART="easeInQuart",s.EASEOUTQUART="easeOutQuart",s.EASEINOUTQUART="easeInOutQuart",s.EASEINQUINT="easeInQuint",s.EASEOUTQUINT="easeOutQuint",s.EASEINOUTQUINT="easeInOutQuint",s.EASEINSINE="easeInSine",s.EASEOUTSINE="easeOutSine",s.EASEINOUTSINE="easeInOutSine",s.EASEINEXPO="easeInExpo",s.EASEOUTEXPO="easeOutExpo",s.EASEINOUTEXPO="easeInOutExpo",s.EASEINCIRC="easeInCirc",s.EASEOUTCIRC="easeOutCirc",s.EASEINOUTCIRC="easeInOutCirc",s.EASEINELASTIC="easeInElastic",s.EASEOUTELASTIC="easeOutElastic",s.EASEINOUTELASTIC="easeInOutElastic",s.EASEINBACK="easeInBack",s.EASEOUTBACK="easeOutBack",s.EASEINOUTBACK="easeInOutBack",s.EASEINBOUNCE="easeInBounce",s.EASEOUTBOUNCE="easeOutBounce",s.EASEINOUTBOUNCE="easeInOutBounce",s}),bento.define("bento/renderers/canvas2d",["bento/utils"],function(t){return function(e,n){var i=e.getContext("2d"),o=i,r=n.pixelSize||1,a={name:"canvas2d",save:function(){i.save()},restore:function(){i.restore()},setTransform:function(t,e,n,o,r,a){i.setTransform(t,e,n,o,r,a)},translate:function(t,e){i.translate(t,e)},scale:function(t,e){i.scale(t,e)},rotate:function(t){i.rotate(t)},fillRect:function(t,e,n,o,r){var a=s(t),u=i.globalAlpha;1!==t[3]&&(i.globalAlpha=t[3]),i.fillStyle=a,i.fillRect(e,n,o,r),1!==t[3]&&(i.globalAlpha=u)},fillCircle:function(t,e,n,o){var r=s(t),a=i.globalAlpha;1!==t[3]&&(i.globalAlpha=t[3]),i.fillStyle=r,i.beginPath(),i.arc(e,n,o,0,2*Math.PI),i.fill(),i.closePath(),1!==t[3]&&(i.globalAlpha=a)},strokeRect:function(t,e,n,o,r,a){var u=s(t),c=i.globalAlpha;1!==t[3]&&(i.globalAlpha=t[3]),i.lineWidth=a||0,i.strokeStyle=u,i.strokeRect(e,n,o,r),1!==t[3]&&(i.globalAlpha=c)},strokeCircle:function(t,e,n,o,r,a,u){var c=s(t);i.globalAlpha;r=r||0,a=a||0,1!==t[3]&&(i.globalAlpha=t[3]),i.strokeStyle=c,i.lineWidth=u||0,i.beginPath(),i.arc(e,n,o,r,a,!1),i.stroke(),i.closePath()},drawLine:function(e,n,o,r,a,u){var c=s(e),h=i.globalAlpha;1!==e[3]&&(i.globalAlpha=e[3]),t.isDefined(u)||(u=1),i.strokeStyle=c,i.lineWidth=u,i.beginPath(),i.moveTo(n,o),i.lineTo(r,a),i.stroke(),i.closePath(),1!==e[3]&&(i.globalAlpha=h)},drawImage:function(t,e,n,o,r,a,s,u,c){i.drawImage(t.image,t.x+e,t.y+n,o,r,a,s,u,c)},getOpacity:function(){return i.globalAlpha},setOpacity:function(t){i.globalAlpha=t},createSurface:function(t,n){var i,o=document.createElement("canvas");return o.width=t,o.height=n,i=e.getContext("2d"),{canvas:o,context:i}},setContext:function(t){i=t},restoreContext:function(){i=o},getContext:function(){return i},begin:function(){i===o&&1!==r&&(i.save(),i.scale(r,r))},flush:function(){i===o&&1!==r&&i.restore()}},s=function(t){var e="#";return e+=("00"+Math.floor(255*t[0]).toString(16)).slice(-2),e+=("00"+Math.floor(255*t[1]).toString(16)).slice(-2),e+=("00"+Math.floor(255*t[2]).toString(16)).slice(-2)};return n.smoothing||(i.imageSmoothingEnabled&&(i.imageSmoothingEnabled=!1),i.webkitImageSmoothingEnabled&&(i.webkitImageSmoothingEnabled=!1),i.mozImageSmoothingEnabled&&(i.mozImageSmoothingEnabled=!1),i.msImageSmoothingEnabled&&(i.msImageSmoothingEnabled=!1)),a}}),bento.define("bento/renderers/pixi",["bento","bento/utils","bento/math/transformmatrix","bento/renderers/canvas2d"],function(t,e,n,i){var o=window.PIXI,r=function(t){var e;for(this.sprites=[],e=0;t>e;++e)this.sprites.push(new o.Sprite);this.index=0};return r.prototype.reset=function(){this.index=0},r.prototype.getSprite=function(){var t=this.sprites[this.index];return t||(t=new o.Sprite,this.sprites.push(t)),this.index+=1,t},function(t,a){var s,u,c,h,d,l,f=function(){try{return s=t.getContext("webgl")||t.getContext("experimental-webgl"),!!window.WebGLRenderingContext}catch(e){return!1}}(),p=[],g=1,m=1,v=a.pixelSize||1,y=null,w=new r(2e3),b={worldTransform:null,worldAlpha:1,children:[]},x=function(){var t=new o.Matrix;return t.a=u.a,t.b=u.b,t.c=u.c,t.d=u.d,t.tx=u.tx,t.ty=u.ty,t},E=function(t){var e=new o.Graphics,n=255*t[2]+(255*t[1]<<8)+(255*t[0]<<16),i=t[3];return e.beginFill(n,i),e.worldTransform=x(),e.worldAlpha=g,e},S={name:"pixi",init:function(){},destroy:function(){},save:function(){p.push(u.clone())},restore:function(){u=p.pop()},setTransform:function(t,e,n,i,o,r){u.a=t,u.b=e,u.c=n,u.d=i,u.tx=o,u.ty=r},translate:function(t,e){var i=new n;u.multiplyWith(i.translate(t,e))},scale:function(t,e){var i=new n;u.multiplyWith(i.scale(t,e))},rotate:function(t){var e=new n;u.multiplyWith(e.rotate(t))},fillRect:function(t,e,n,i,o){var r=E(t);r.drawRect(e,n,i,o),c.setObjectRenderer(l),l.render(r)},fillCircle:function(t,e,n,i){var o=E(t);o.drawCircle(e,n,i),c.setObjectRenderer(l),l.render(o)},strokeRect:function(t,e,n,i,r,a){var s=new o.Graphics,u=255*t[2]+(255*t[1]<<8)+(255*t[0]<<16),h=t[3];s.worldTransform=x(),s.worldAlpha=g,s.lineStyle(a,u,h),s.drawRect(e,n,i,r),c.setObjectRenderer(l),l.render(s)},strokeCircle:function(t,e,n,i,r,a,s){var u=new o.Graphics,h=255*t[2]+(255*t[1]<<8)+(255*t[0]<<16),d=t[3];u.worldTransform=x(),u.worldAlpha=g,u.lineStyle(s,h,d).arc(e,n,i,r,a),c.setObjectRenderer(l),l.render(u)},drawLine:function(t,n,i,o,r,a){var s=E(t),u=255*t[2]+(255*t[1]<<8)+(255*t[0]<<16);e.isDefined(a)||(a=1),e.isDefined(t[3])||(t[3]=1),s.lineStyle(a,u,t[3]).moveTo(n,i).lineTo(o,r).endFill(),c.setObjectRenderer(l),l.render(s)},drawImage:function(t,e,n,i,r,a,s,d,l){var f,p,m=t.image,v=t.x,y=t.y,b=w.getSprite();return v+e+i>m.width||y+n+r>m.height?void console.error("Warning: image and frame size do not correspond.",m):(m.texture||(m.texture=new o.BaseTexture(m,o.SCALE_MODES.NEAREST),m.frame=new o.Texture(m.texture)),p=m.frame,f=p._frame,f.x=v+e,f.y=y+n,f.width=i,f.height=r,p._updateUvs(),b._texture=p,S.save(),S.translate(a,s),S.scale(d/i,l/r),b.worldTransform=u,b.worldAlpha=g,c.setObjectRenderer(h),h.render(b),S.restore(),void(0===h.currentBatchSize&&w.reset()))},begin:function(){h.start(),(1!==v||e.isCocoonJs())&&(this.save(),this.scale(v*m,v*m))},flush:function(){h.flush(),w.reset(),(1!==v||e.isCocoonJs())&&this.restore()},getOpacity:function(){return g},setOpacity:function(t){g=t},drawPixi:function(t){b.worldTransform=u,b.worldAlpha=g,t.parent=b,t.updateTransform(),t.renderWebGL(c)},getContext:function(){return s},getPixiRenderer:function(){return c},updateSize:function(){c.resize(t.width,t.height)}};return f&&e.isDefined(window.PIXI)?(u=new n,e.isCocoonJs()&&(m=window.innerWidth*window.devicePixelRatio/t.width,t.width*=m,t.height*=m),c=new o.WebGLRenderer(t.width,t.height,{view:t,backgroundColor:0,clearBeforeRender:!1}),c.filterManager.setFilterStack(c.renderTarget.filterStack),y=c._tempDisplayObjectParent,h=c.plugins.sprite,l=c.plugins.graphics,d=c.plugins.mesh,S):(window.PIXI?f||console.log("WARNING: WebGL not available, reverting to Canvas2D renderer"):console.log("WARNING: PIXI library is missing, reverting to Canvas2D renderer"),i(t,a))}}),bento.define("bento/components/pixi/sprite",["bento","bento/utils","bento/components/sprite"],function(t,e,n){"use strict";var i=function(t){return this instanceof i?(n.call(this,t),void(this.sprite=new window.PIXI.Sprite)):new i(t)};return i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.draw=function(t){var e=t.entity,n=e.origin;this.currentAnimation&&this.visible&&(this.updateFrame(),this.updateSprite(this.spriteImage,this.sourceX,this.sourceY,this.frameWidth,this.frameHeight),t.renderer.translate(-Math.round(n.x),-Math.round(n.y)),t.renderer.drawPixi(this.sprite),t.renderer.translate(Math.round(n.x),Math.round(n.y)))},i.prototype.updateSprite=function(t,e,n,i,o){var r,a,s;t&&(s=t.image,s.texture||(s.texture=new window.PIXI.BaseTexture(s,window.PIXI.SCALE_MODES.NEAREST)),r=new window.PIXI.Rectangle(e,n,i,o),a=new window.PIXI.Texture(s.texture,r),a._updateUvs(),this.sprite.texture=a)},i.prototype.toString=function(){return"[object PixiSprite]"},i}),bento.define("bento/gui/clickbutton",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/utils","bento/tween","bento/eventsystem"],function(t,e,n,i,o,r,a,s,u){"use strict";var c=function(n){var s=(t.getViewport(),!0),h=n.animations||{up:{speed:0,frames:[0]},down:{speed:0,frames:[1]}},d=n.sprite||new i({image:n.image,imageName:n.imageName,frameWidth:n.frameWidth,frameHeight:n.frameHeight,frameCountX:n.frameCountX,frameCountY:n.frameCountY,animations:h}),l=!1,f=new o({sort:n.sort,onClick:function(){l=!1,s&&!c.currentlyPressing&&(c.currentlyPressing=g,d.setAnimation("down"),n.onButtonDown&&n.onButtonDown.apply(g),u.fire("clickButton-onButtonDown",{entity:g,event:"onClick"}))},onHoldEnter:function(){s&&(d.setAnimation("down"),n.onButtonDown&&n.onButtonDown.apply(g),u.fire("clickButton-onButtonDown",{entity:g,event:"onHoldEnter"}))},onHoldLeave:function(){s&&(d.setAnimation("up"),n.onButtonUp&&n.onButtonUp.apply(g),u.fire("clickButton-onButtonUp",{entity:g,event:"onHoldLeave"}))},pointerUp:function(){s&&(d.setAnimation("up"),n.onButtonUp&&n.onButtonUp.apply(g),u.fire("clickButton-onButtonUp",{entity:g,event:"pointerUp"}),c.currentlyPressing===g&&(l=!0,c.currentlyPressing=null))},onHoldEnd:function(){s&&n.onClick&&(c.currentlyPressing===g||l)&&(l=!1,n.onClick.apply(g),n.sfx&&(t.audio.stopSound(n.sfx),t.audio.playSound(n.sfx)),u.fire("clickButton-onClick",{entity:g,event:"onHoldEnd"})),c.currentlyPressing=null},onClickMiss:function(t){n.onClickMiss&&n.onClickMiss(t)}}),p=a.extend({z:0,name:"clickButton",originRelative:new e(.5,.5),position:new e(0,0),components:[d,f],family:["buttons"],init:function(){h=d.animations||h,!s&&h.inactive?d.setAnimation("inactive"):d.setAnimation("up")}},n),g=new r(p).extend({setActive:function(t){s=t,!s&&h.inactive?d.setAnimation("inactive"):d.setAnimation("up")},doCallback:function(){n.onClick.apply(g)},isActive:function(){return s}});return a.isDefined(n.active)&&(s=n.active),g.attach({name:"attachComponent",start:function(){u.fire("clickButton-start",{entity:g})},destroy:function(){u.fire("clickButton-destroy",{entity:g}),c.currentlyPressing===g&&(c.currentlyPressing=null)}}),g};return c.currentlyPressing=null,c}),bento.define("bento/gui/counter",["bento","bento/entity","bento/math/vector2","bento/components/sprite","bento/utils"],function(t,e,n,i,o){"use strict";return function(t){var r,a=t.value||0,s=t.spacing||new n(0,0),u=t.align||t.alignment||"right",c=0,h=[],d={},l=function(){return a.toString().length},f=function(){var n={0:{frames:[0]},1:{frames:[1]},2:{frames:[2]},3:{frames:[3]},4:{frames:[4]},5:{frames:[5]},6:{frames:[6]},7:{frames:[7]},8:{frames:[8]},9:{frames:[9]}},r=new i({image:d.image,imageName:d.imageName,frameWidth:d.frameWidth,frameHeight:d.frameHeight,frameCountX:d.frameCountX,frameCountY:d.frameCountY,animations:t.animations||n}),a=o.extend({components:[r]},t.digit||{}),s=new e(a);return c=r.frameWidth,s},p=function(){var t,e,i,o=a.toString(),d=l(),p=h.length-d;if(0>p)for(t=0;t<Math.abs(p);++t)i=f(),h.push(i),r.attach(i);else if(p>0)for(t=0;t<Math.abs(p);++t)i=h.pop(),r.remove(i);for(t=0;t<h.length;++t)i=h[t],i.position=new n((c+s.x)*t,0),i.getComponent("sprite",function(e){e.setAnimation(o.substr(t,1))});if("right"===u)for(t=0;t<h.length;++t)i=h[t],e=i.position,e.substractFrom(new n((c+s.x)*d-s.x,0));else if("center"===u)for(t=0;t<h.length;++t)i=h[t],e=i.position,e.addTo(new n(((c+s.x)*d-s.x)/-2,0))},g={z:t.z,name:t.name,position:t.position,components:[]};return d.image=t.image,d.imageName=t.imageName,d.frameWidth=t.frameWidth,d.frameHeight=t.frameHeight,d.frameCountX=t.frameCountX,d.frameCountY=t.frameCountY,t.sprite&&(t.sprite=t.sprite.animationSettings,d.image=t.sprite.image,d.imageName=t.sprite.imageName,d.frameWidth=t.sprite.frameWidth,d.frameHeight=t.sprite.frameHeight,d.frameCountX=t.sprite.frameCountX,d.frameCountY=t.sprite.frameCountY),o.extend(g,t),r=new e(g).extend({setValue:function(t){a=t,p()},getValue:function(){return a},addValue:function(t){a+=t,p()},getDigits:function(){return l()},loopDigits:function(t){var e=0;for(e=0;e<h.length;++e)t(h[e])}}),p(),r}}),bento.define("bento/gui/text",["bento","bento/math/vector2","bento/math/rectangle","bento/entity","bento/utils","bento/components/sprite","bento/packedimage"],function(t,e,n,i,o,r,a){"use strict";var s=function(t){var e;if(""===t||0===t||"0"===t||null===t||t===!1||!o.isDefined(t))return!0;if(o.isArray(t)&&0===t.length)return!0;if(o.isObject(t)){for(e in t)if(o.has(t,e))return!1;return!0}return!1},u=function(t){var c,h,d,l,f="",p=!0,g="normal",m=["black","white"],v="left",y="arial",w=16,b=32,x="black",E=[0],S=0,k=["black"],P=[!1],O="top",A=!1,C=!1,M=[],I=0,R=new e(8,8),D=0,T=null,L=document.createElement("canvas"),j=L.getContext("2d"),N=1,W=1,_="source-over",B=new a(L),U=4,q=1/U,H={},F=t.drawDebug||!1,z=function(e){var n,i,r;if(e.fontSettings&&o.extend(e,e.fontSettings),e.sharpness&&(U=e.sharpness,q=1/U),e.fontSize&&(e.fontSize*=U),e.maxWidth&&(e.maxWidth*=U),e.gradient&&(d=e.gradient),e.gradientColors)for(m=[],n=0,i=e.gradientColors.length;i>n;++n)m[n]=e.gradientColors[n];for(e.overlaySprite&&(T=e.overlaySprite,T.initialized||(T.init(),T.initialized=!0)),e.align&&(v=e.align),o.isDefined(e.ySpacing)&&(D=e.ySpacing*U),e.font&&(y=e.font),o.isDefined(e.fontSize)&&(w=e.fontSize,b=w),e.fontColor&&(x=e.fontColor),e.textBaseline&&(O=e.textBaseline),e.centerByCanvas&&(C=e.centerByCanvas),o.isDefined(e.fontWeight)&&(g=e.fontWeight),o.isDefined(e.lineWidth)&&(o.isArray(e.lineWidth)?(E=e.lineWidth,o.forEach(E,function(t,e,n,i){E[e]*=U})):E=[e.lineWidth*U]),e.strokeStyle&&(k=o.isArray(e.strokeStyle)?e.strokeStyle:[e.strokeStyle]),e.innerStroke&&(P=o.isArray(e.innerStroke)?e.innerStroke:[e.innerStroke]),A=e.pixelStroke||!1,r=Math.max(E.length,k.length,P.length);E.length<r;)E.push(0);for(;k.length<r;)k.push("black");for(;P.length<r;)P.push(!1);for(S=0,n=0,i=E.length;i>n;++n)S=Math.max(S,2*E[n]);o.isDefined(e.linebreaks)&&(p=e.linebreaks),c=o.isDefined(e.maxWidth)?e.maxWidth:null,h=o.isDefined(e.maxHeight)?e.maxHeight*U:null,o.isDefined(e.margin)&&(R=e.margin),e.text?l.setText(t.text):l.setText(f)},G=function(){var t,i,r,u,c,h=new e(S/2,S/2),d=K.origin,f=(l.position,function(){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=L.width,e.height=L.height,Y(n),n.fillStyle=k[i],n.fillText(M[t].string,~~r,~~u+(navigator.isCocoonJS?0:.5)),j.drawImage(e,0,0,e.width,e.height,0,-E,e.width,e.height),j.drawImage(e,0,0,e.width,e.height,-E,-E,e.width,e.height),j.drawImage(e,0,0,e.width,e.height,-E,0,e.width,e.height),j.drawImage(e,0,0,e.width,e.height,-E,E,e.width,e.height),j.drawImage(e,0,0,e.width,e.height,0,E,e.width,e.height),j.drawImage(e,0,0,e.width,e.height,E,E,e.width,e.height),j.drawImage(e,0,0,e.width,e.height,E,0,e.width,e.height),j.drawImage(e,0,0,e.width,e.height,E,-E,e.width,e.height)});switch(L.width=N+S+2*R.x,L.height=W+S+2*R.y,j.clearRect(0,0,L.width,L.height),l.dimension=new n(0,0,L.width/U,L.height/U),T&&(c=L.width/T.getDimension().width,T.scalable&&T.scalable.setScale(new e(c,c))),v){case"left":d.x=0;break;case"center":d.x=R.x+N/2;break;case"right":d.x=R.x+N}switch(O){case"top":d.y=0;break;case"middle":d.y=(C?L.height:W)/2;break;case"bottom":d.y=C?L.height:W}for(Y(j),t=0;t<M.length;++t){if(o.isDefined(M[t].gradient)?j.fillStyle=M[t].gradient:j.fillStyle=x,r=h.x+d.x+M[t].spaceWidth/2,u=h.y+(t+1)*w+R.y+D*t,j.globalCompositeOperation="source-over",A)for(i=E.length-1;i>=0;--i)E[i]&&!P[i]&&f();for(j.globalCompositeOperation="source-over",j.fillText(M[t].string,~~r,~~u+(navigator.isCocoonJS?0:.5)),s(T)||(j.globalCompositeOperation="source-atop",T.setPosition(new e(r,u-w)),T.draw({canvas:L,context:j})),j.globalCompositeOperation="source-atop",i=0;i<E.length;++i)E[i]&&P[i]&&(j.lineWidth=2*E[i],j.strokeStyle=k[i],j.strokeText(M[t].string,~~r,~~u));if(!A)for(j.globalCompositeOperation="destination-over",i=E.length-1;i>=0;--i)E[i]&&!P[i]&&(j.lineWidth=2*E[i],j.strokeStyle=k[i],j.strokeText(M[t].string,~~r,~~u))}X(j),L.texture=null,B=new a(L),K.setup({image:B})},X=function(t){t.textAlign="left",t.textBaseline="bottom",t.lineWidth=0,t.strokeStyle="black",t.fillStyle="black",t.globalCompositeOperation=_,t.restore()},Y=function(t){t.save(),t.textAlign=v,t.textBaseline="bottom",t.font=g+" "+w.toString()+"px "+y,_=t.globalCompositeOperation},Q=function(){var t,e,n,i,o,r,a,u,h=(""+f).split("\n");for(M=[],N=1,W=1,Y(j),n=0;n<h.length;++n){if(I=0,e=h[n],t=j.measureText(e).width,p&&!s(c)&&t>c){for(i=0;t>c;)if(++i,r=e.slice(0,e.length-i),t=j.measureText(r).width,i===e.length){i=e.length-1;break}u=r.lastIndexOf(" "),u>0&&u!=r.length&&(i+=r.length-u),a=e.slice(e.length-i,e.length),e=e.slice(0,e.length-i)," "===a.charAt(0)&&(a=a.slice(1)),0!==a.length&&h.splice(n+1,0,a),t=j.measureText(e).width}t>N&&(N=t),o=J(t,n),M.push({string:e,width:t,gradient:o,spaceWidth:I}),W+=w+D}},J=function(t,e){var n,i,o,r,a,s={x:0,y:0},u={x:0,y:0};if(d){switch(r=(w+D)*e,a=(w+D)*(e+1),d){case"top-down":s.x=0,s.y=r,u.x=0,u.y=a;break;case"down-top":s.x=0,s.y=a,u.x=0,u.y=r;break;case"left-right":s.x=0,s.y=0,u.x=t,u.y=0;break;case"right-left":s.x=t,s.y=0,u.x=0,u.y=0;break;case"topleft-downright":s.x=0,s.y=r,u.x=t,u.y=a;break;case"topright-downleft":s.x=t,s.y=r,u.x=0,u.y=a;break;case"downleft-topright":s.x=0,s.y=a,u.x=t,u.y=r;break;case"downright-topleft":s.x=t,s.y=a,u.x=0,u.y=r}for(s.x+=S/2,s.y+=S/2,u.x+=S/2,u.y+=S/2,n=j.createLinearGradient(s.x,s.y,u.x,u.y),o=0;o<m.length;++o)i=o*(1/(m.length-1)),n.addColorStop(i,m[o]);return n}},V={name:"sharpnessScaler",draw:function(t){t.renderer.scale(q,q);var i,o,r=new e(0,0),a=new e(0,0);!u.drawDebug&&!F||null===c&&null===h||(i=t.entity,r.x=K.origin.x/i.dimension.width,r.y=K.origin.y/i.dimension.height,a=K.origin.clone(),null!==c&&(a.x=r.x*c),null!==h&&(a.y=r.y*h),o=new n(-1*a.x||0,-1*a.y||0,c||i.dimension.width,h||i.dimension.height),t.renderer.fillRect([0,0,1,.25],o.x,o.y,o.width,o.height),null!==c&&(t.renderer.drawLine([0,0,1,.5],o.x,o.y,o.x,o.y+o.height,1),t.renderer.drawLine([0,0,1,.5],o.x+o.width,o.y,o.x+o.width,o.y+o.height,1)),null!==h&&(t.renderer.drawLine([0,0,1,.5],o.x,o.y,o.x+o.width,o.y,1),t.renderer.drawLine([0,0,1,.5],o.x,o.y+o.height,o.x+o.width,o.y+o.height,1)))}},K=new r({image:B}),Z=o.extend({z:0,name:"text",position:new e(0,0)},t,!0);return Z.components=[V,K].concat(Z.components||[]),l=new i(Z).extend({getText:function(){return f},getStrings:function(){return M},setText:function(t,e){var n;if(w=b,e&&z(e),f=t,Q(),s(c)&&s(h)||(n=o.checksum(t)),o.isDefined(H[n]))w=H[n],Q();else{for(;w>0&&(!s(c)&&N>c||!s(h)&&W>h);)w-=1,Q();H[n]=w}G()}}),z(t),l};return u.drawDebug=!1,u}),bento.define("bento/gui/togglebutton",["bento","bento/math/vector2","bento/math/rectangle","bento/components/sprite","bento/components/clickable","bento/entity","bento/utils","bento/tween","bento/eventsystem"],function(t,e,n,i,o,r,a,s,u){"use strict";return function(n){var s=(t.getViewport(),!0),c=!1,h=n.animations||{up:{speed:0,frames:[0]},down:{speed:0,frames:[1]}},d=n.sprite||new i({image:n.image,imageName:n.imageName,frameWidth:n.frameWidth,frameHeight:n.frameHeight,frameCountX:n.frameCountX,frameCountY:n.frameCountY,animations:h}),l=a.extend({z:0,name:"toggleButton",originRelative:new e(.5,.5),position:new e(0,0),components:[d,new o({onClick:function(){d.setAnimation("down"),u.fire("toggleButton-toggle-down",{entity:f,event:"onClick"})},onHoldEnter:function(){d.setAnimation("down"),u.fire("toggleButton-toggle-down",{entity:f,event:"onHoldEnter"})},onHoldLeave:function(){d.setAnimation(c?"down":"up"),u.fire("toggleButton-toggle-"+(c?"down":"up"),{entity:f,event:"onHoldLeave"})},pointerUp:function(){d.setAnimation(c?"down":"up"),u.fire("toggleButton-toggle-"+(c?"down":"up"),{entity:f,event:"pointerUp"})},onHoldEnd:function(){s&&(c=c?!1:!0,n.onToggle&&(n.onToggle.apply(f),n.sfx&&(t.audio.stopSound(n.sfx),t.audio.playSound(n.sfx))),d.setAnimation(c?"down":"up"),u.fire("toggleButton-onToggle",{entity:f,event:"onHoldEnd"}))}})],family:["buttons"]},n),f=new r(l).extend({isToggled:function(){return c},toggle:function(e,i){c=a.isDefined(e)?e:!c,i&&n.onToggle&&(n.onToggle.apply(f),n.sfx&&(t.audio.stopSound(n.sfx),t.audio.playSound(n.sfx))),d.setAnimation(c?"down":"up")},mimicClick:function(){f.getComponent("clickable").callbacks.onHoldEnd()},setActive:function(t){s=t,!s&&h.inactive?d.setAnimation("inactive"):d.setAnimation(c?"down":"up")},doCallback:function(){n.onToggle.apply(f)},isActive:function(){return s}});return a.isDefined(n.active)&&(s=n.active),n.toggled&&(c=!0),h=d.animations||h,!s&&h.inactive?d.setAnimation("inactive"):d.setAnimation(c?"down":"up"),f.attach({name:"attachComponent",start:function(){u.fire("toggleButton-start",{entity:f})},destroy:function(){u.fire("toggleButton-destroy",{entity:f})}}),f}});